# ЁЯФР Auth Service тАФ рж╕ржорзНржкрзВрж░рзНржг ржмрж╛ржВрж▓рж╛ ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи

> **ржЙржжрзНржжрзЗрж╢рзНржп**: ржПржЗ ржбржХрзБржорзЗржирзНржЯржЯрж┐ ржкржбрж╝рзЗ ржПржХржЬржи ржЬрзБржирж┐ржпрж╝рж░ ржЗржЮрзНржЬрж┐ржирж┐ржпрж╝рж╛рж░ ржкрзБрж░рзЛ `backend-authenication` ржкрзНрж░ржЬрзЗржХрзНржЯрзЗрж░ ржкрзНрж░рждрж┐ржЯрж╛ рж▓рж╛ржЗржи ржмрзБржЭрждрзЗ ржкрж╛рж░ржмрзЗ ржПржмржВ ржнржмрж┐рж╖рзНржпрждрзЗ ржирж┐ржЬрзЗ ржПржЗ ржзрж░ржирзЗрж░ ржХрж╛ржЬ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗред

---

## ЁЯУС рж╕рзВржЪрж┐ржкрждрзНрж░

| ржЕржзрзНржпрж╛ржпрж╝ | ржмрж┐рж╖ржпрж╝                                                                                     |
| ------- | ----------------------------------------------------------------------------------------- |
| рзз       | [ржкрзНрж░ржЬрзЗржХрзНржЯ ржУржнрж╛рж░ржнрж┐ржЙ ржУ ржлрзЛрж▓рзНржбрж╛рж░ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░](#ржЕржзрзНржпрж╛ржпрж╝-рзз-ржкрзНрж░ржЬрзЗржХрзНржЯ-ржУржнрж╛рж░ржнрж┐ржЙ-ржУ-ржлрзЛрж▓рзНржбрж╛рж░-рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░) |
| рзи       | [Environment Configuration](#ржЕржзрзНржпрж╛ржпрж╝-рзи-environment-configuration)                         |
| рзй       | [Package ржУ Dependencies](#ржЕржзрзНржпрж╛ржпрж╝-рзй-package-ржУ-dependencies)                               |
| рзк       | [Database тАФ Prisma ORM](#ржЕржзрзНржпрж╛ржпрж╝-рзк-database--prisma-orm)                                  |
| рзл       | [ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржПржирзНржЯрзНрж░рж┐ ржкржпрж╝рзЗржирзНржЯ](#ржЕржзрзНржпрж╛ржпрж╝-рзл-ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи-ржПржирзНржЯрзНрж░рж┐-ржкржпрж╝рзЗржирзНржЯ)                   |
| рзм       | [Utilities тАФ Hash ржУ Token](#ржЕржзрзНржпрж╛ржпрж╝-рзм-utilities--hash-ржУ-token)                            |
| рзн       | [Middlewares](#ржЕржзрзНржпрж╛ржпрж╝-рзн-middlewares)                                                     |
| рзо       | [Auth Module тАФ ржорзВрж▓ ржмрзНржпржмрж╕рж╛ржпрж╝рж┐ржХ рж▓ржЬрж┐ржХ](#ржЕржзрзНржпрж╛ржпрж╝-рзо-auth-module--ржорзВрж▓-ржмрзНржпржмрж╕рж╛ржпрж╝рж┐ржХ-рж▓ржЬрж┐ржХ)          |
| рзп       | [Security Best Practices](#ржЕржзрзНржпрж╛ржпрж╝-рзп-security-best-practices)                             |
| рззрзж      | [Docker ржУ Containerization](#ржЕржзрзНржпрж╛ржпрж╝-рззрзж-docker-ржУ-containerization)                        |
| рззрзз      | [CI/CD Pipeline тАФ GitHub Actions](#ржЕржзрзНржпрж╛ржпрж╝-рззрзз-cicd-pipeline--github-actions)              |
| рззрзи      | [ESLint ржУ Code Quality](#ржЕржзрзНржпрж╛ржпрж╝-рззрзи-eslint-ржУ-code-quality)                                |
| рззрзй      | [Testing тАФ Jest](#ржЕржзрзНржпрж╛ржпрж╝-рззрзй-testing--jest)                                               |
| рззрзк      | [рж╕ржорзНржкрзВрж░рзНржг API Reference](#ржЕржзрзНржпрж╛ржпрж╝-рззрзк-рж╕ржорзНржкрзВрж░рзНржг-api-reference)                              |
| рззрзл      | [ЁЯР│ Docker тАФ Scratch ржерзЗржХрзЗ Pro + Cheat Sheet](#ржЕржзрзНржпрж╛ржпрж╝-рззрзл-docker--scratch-ржерзЗржХрзЗ-pro)        |
| рззрзм      | [ЁЯЪА CI/CD Pipeline тАФ Scratch ржерзЗржХрзЗ Pro](#ржЕржзрзНржпрж╛ржпрж╝-рззрзм-cicd-pipeline--scratch-ржерзЗржХрзЗ-pro)       |

---

# ржЕржзрзНржпрж╛ржпрж╝ рзз: ржкрзНрж░ржЬрзЗржХрзНржЯ ржУржнрж╛рж░ржнрж┐ржЙ ржУ ржлрзЛрж▓рзНржбрж╛рж░ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░

## ЁЯОп ржПржЗ ржкрзНрж░ржЬрзЗржХрзНржЯ ржХрзА ржХрж░рзЗ?

ржПржЗ ржкрзНрж░ржЬрзЗржХрзНржЯржЯрж┐ ржПржХржЯрж┐ **Authentication Service** тАФ ржорж╛ржирзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ **рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи (Signup)**, **рж▓ржЧржЗржи (Login)**, **рж▓ржЧржЖржЙржЯ (Logout)**, ржПржмржВ **ржЯрзЛржХрзЗржи рж░рж┐ржлрзНрж░рзЗрж╢ (Refresh Token)** ржПрж░ ржХрж╛ржЬ ржХрж░рзЗред

### ЁЯПа ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг ржжрж┐ржпрж╝рзЗ ржмрзБржЭрж┐

ржПржХржЯрж╛ ржЕржлрж┐рж╕ ржмрж┐рж▓рзНржбрж┐ржВржпрж╝рзЗрж░ ржХржерж╛ ржнрж╛ржмрзЛ:

- **Signup** = ржЕржлрж┐рж╕рзЗ ржирждрзБржи ржХрж░рзНржоржЪрж╛рж░рзА рж╣рж┐рж╕рзЗржмрзЗ ржирж╛ржо рж▓рзЗржЦрж╛ржирзЛ (ID Card ржкрж╛ржУржпрж╝рж╛)
- **Login** = ржЕржлрж┐рж╕рзЗ ржврзЛржХрж╛рж░ рж╕ржоржпрж╝ ID ржжрзЗржЦрж┐ржпрж╝рзЗ ржнрж┐ржЬрж┐ржЯрж░ ржкрж╛рж╕ ржирзЗржУржпрж╝рж╛
- **Access Token** = ржнрж┐ржЬрж┐ржЯрж░ ржкрж╛рж╕ (ржЕрж▓рзНржк рж╕ржоржпрж╝рзЗрж░ ржЬржирзНржп, рззрзл ржорж┐ржирж┐ржЯ)
- **Refresh Token** = ржорзВрж▓ ID Card (ржжрзАрж░рзНржШ рж╕ржоржпрж╝рзЗрж░ ржЬржирзНржп, рзн ржжрж┐ржи)
- **Logout** = ржЕржлрж┐рж╕ ржерзЗржХрзЗ ржмрзЗрж░ рж╣ржпрж╝рзЗ ржкрж╛рж╕ ржлрзЗрж░ржд ржжрзЗржУржпрж╝рж╛

## ЁЯУБ ржлрзЛрж▓рзНржбрж╛рж░ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░

```
auth-service/
тФЬтФАтФА .env                          # ЁЯФТ ржЧрзЛржкржи ржЪрж╛ржмрж┐ржХрж╛ржарж┐ (secret keys, DB password)
тФЬтФАтФА .env.example                  # ЁЯУЛ .env-ржПрж░ ржиржорзБржирж╛ (ржЯрж┐ржорзЗрж░ ржЬржирзНржп)
тФЬтФАтФА .gitignore                    # ЁЯЪл Git-ржП ржХрзА ржЖржкрж▓рзЛржб рж╣ржмрзЗ ржирж╛
тФЬтФАтФА .github/
тФВ   тФФтФАтФА workflows/
тФВ       тФЬтФАтФА ci.yml                # тЬЕ CI Pipeline (ржХрзЛржб ржЪрзЗржХ)
тФВ       тФФтФАтФА deploy.yml            # ЁЯЪА Deploy Pipeline (рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржкрж╛ржарж╛ржирзЛ)
тФЬтФАтФА Dockerfile                    # ЁЯР│ Docker image рждрзИрж░рж┐рж░ рж░рзЗрж╕рж┐ржкрж┐
тФЬтФАтФА docker-compose.yml            # ЁЯО╝ рж╕ржм container ржПржХрж╕рж╛ржерзЗ ржЪрж╛рж▓рж╛ржирзЛрж░ ржХржиржлрж┐ржЧ
тФЬтФАтФА eslint.config.mjs             # ЁЯУП ржХрзЛржб ржХрзЛржпрж╝рж╛рж▓рж┐ржЯрж┐ рж░рзБрж▓рж╕
тФЬтФАтФА package.json                  # ЁЯУж ржкрзНрж░ржЬрзЗржХрзНржЯрзЗрж░ рждржерзНржп ржУ dependencies
тФЬтФАтФА package-lock.json             # ЁЯФТ exact dependency versions
тФЬтФАтФА prisma/
тФВ   тФЬтФАтФА schema.prisma             # ЁЯУК Database ржПрж░ ржиржХрж╢рж╛ (tables/models)
тФВ   тФФтФАтФА migrations/               # ЁЯУЭ Database ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржЗрждрж┐рж╣рж╛рж╕
тФЬтФАтФА prisma.config.ts              # тЪЩя╕П Prisma ржПрж░ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи
тФФтФАтФА src/                          # ЁЯТ╗ ржорзВрж▓ рж╕рзЛрж░рзНрж╕ ржХрзЛржб
    тФЬтФАтФА server.js                 # ЁЯЪк рж╕рж╛рж░рзНржнрж╛рж░ ржЪрж╛рж▓рзБ ржХрж░рж╛рж░ ржлрж╛ржЗрж▓ (entry point)
    тФЬтФАтФА app.js                    # ЁЯПЧя╕П Express app рж╕рзЗржЯржЖржк
    тФЬтФАтФА config/
    тФВ   тФФтФАтФА prisma.js             # ЁЯФМ Database connection
    тФЬтФАтФА middlewares/
    тФВ   тФЬтФАтФА auth.middleware.js     # ЁЯЫбя╕П Token ржпрж╛ржЪрж╛ржЗ
    тФВ   тФЬтФАтФА error.middleware.js    # тЭМ Error handle
    тФВ   тФФтФАтФА rateLimiter.middleware.js # тП▒я╕П ржЕрждрж┐рж░рж┐ржХрзНржд request ржмрзНрж▓ржХ
    тФЬтФАтФА modules/
    тФВ   тФФтФАтФА auth/
    тФВ       тФЬтФАтФА auth.routes.js    # ЁЯЫдя╕П URL path-ржПрж░ рждрж╛рж▓рж┐ржХрж╛
    тФВ       тФЬтФАтФА auth.controller.js # ЁЯОо Request-Response handle
    тФВ       тФЬтФАтФА auth.service.js   # ЁЯза Business рж▓ржЬрж┐ржХ
    тФВ       тФФтФАтФА auth.repository.js # ЁЯТ╛ Database query
    тФЬтФАтФА utils/
    тФВ   тФЬтФАтФА hash.js               # ЁЯФС Password hashing
    тФВ   тФФтФАтФА token.js              # ЁЯОЯя╕П JWT Token рждрзИрж░рж┐ ржУ ржпрж╛ржЪрж╛ржЗ
    тФФтФАтФА tests/
        тФФтФАтФА health.test.js        # ЁЯзк ржЯрзЗрж╕рзНржЯ ржлрж╛ржЗрж▓
```

### ЁЯПЧя╕П Architecture Pattern: Controller тЖТ Service тЖТ Repository

ржПржЗ ржкрзНрж░ржЬрзЗржХрзНржЯ **MVC-ржПрж░ ржПржХржЯрж┐ ржнрзНржпрж╛рж░рж┐ржпрж╝рзЗржирзНржЯ** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ:

```
[User Request]
      тЖУ
[Routes] тЖТ ржХрзЛржи URL-ржП ржХрзЛржи function ржЪрж▓ржмрзЗ ржарж┐ржХ ржХрж░рзЗ
      тЖУ
[Controller] тЖТ Request ржерзЗржХрзЗ data ржирзЗржпрж╝, Response ржкрж╛ржарж╛ржпрж╝
      тЖУ
[Service] тЖТ business рж▓ржЬрж┐ржХ (password check, token рждрзИрж░рж┐)
      тЖУ
[Repository] тЖТ Database-ржП data read/write
      тЖУ
[Database (MySQL)]
```

**ржЙржжрж╛рж╣рж░ржг**: ржПржХржЯрж╛ рж░рзЗрж╕рзНржЯрзБрж░рзЗржирзНржЯрзЗрж░ ржорждрзЛ ржнрж╛ржмрзЛ:

- **Route** = ржорзЗржирзБ ржХрж╛рж░рзНржб (ржХрзА ржХрзА ржЦрж╛ржмрж╛рж░ ржЖржЫрзЗ)
- **Controller** = ржУржпрж╝рзЗржЯрж╛рж░ (ржЕрж░рзНржбрж╛рж░ ржирзЗржпрж╝, ржЦрж╛ржмрж╛рж░ рж╕рж╛рж░рзНржн ржХрж░рзЗ)
- **Service** = рж╢рзЗржл (ржорзВрж▓ рж░рж╛ржирзНржирж╛рж░ ржХрж╛ржЬ ржХрж░рзЗ)
- **Repository** = рж╕рзНржЯрзЛрж░ рж░рзБржо (ржЙржкржХрж░ржг ржЖржирж╛-ржирзЗржУржпрж╝рж╛)

---

# ржЕржзрзНржпрж╛ржпрж╝ рзи: Environment Configuration

## ЁЯУД `.env.example` тАФ ржиржорзБржирж╛ ржлрж╛ржЗрж▓

ржПржЯрж╛ ржЯрж┐ржорзЗрж░ рж╕ржмрж╛ржЗржХрзЗ ржжрзЗржЦрж╛ржпрж╝ ржпрзЗ ржХрзА ржХрзА environment variable рж▓рж╛ржЧржмрзЗ, ржХрж┐ржирзНрждрзБ ржЖрж╕рж▓ ржорж╛ржи (value) ржжрзЗржУржпрж╝рж╛ ржерж╛ржХрзЗ ржирж╛ред

```bash
PORT=5100
# рж╕рж╛рж░рзНржнрж╛рж░ ржХрзЛржи port-ржП ржЪрж▓ржмрзЗред
# "port" ржорж╛ржирзЗ ржжрж░ржЬрж╛ тАФ рждрзЛржорж╛рж░ ржЕрзНржпрж╛ржк ржХрзЛржи ржжрж░ржЬрж╛ ржжрж┐ржпрж╝рзЗ ржХржерж╛ ржмрж▓ржмрзЗред
# 5100 ржорж╛ржирзЗ 5100 ржиржорзНржмрж░ ржжрж░ржЬрж╛ред

DATABASE_HOST="db"
# Database ржХрзЛржерж╛ржпрж╝ ржЖржЫрзЗ рждрж╛рж░ ржарж┐ржХрж╛ржирж╛ред
# Docker Compose-ржП "db" ржирж╛ржорзЗ ржПржХржЯрж╛ service ржЖржЫрзЗ, рждрж╛ржЗ ржПржЦрж╛ржирзЗ "db" рж▓рзЗржЦрж╛ред
# рж▓рзЛржХрж╛рж▓рзЗ ржХрж╛ржЬ ржХрж░рж▓рзЗ "localhost" рж▓рж┐ржЦрждрзЗ рж╣рждрзЛред

DATABASE_USER=
# Database-ржП ржврзЛржХрж╛рж░ usernameред ржпрзЗржоржи: root

DATABASE_PASSWORD=
# Database-ржПрж░ passwordред ржПржЯрж╛ ржЧрзЛржкржи рж░рж╛ржЦрждрзЗ рж╣ржмрзЗ!

DATABASE_NAME=
# Database-ржПрж░ ржирж╛ржоред ржпрзЗржоржи: authdb

DATABASE_PORT=3306
# MySQL ржПрж░ default port рж╣рж▓рзЛ 3306ред

JWT_ACCESS_SECRET=
# Access Token рж╕рж╛ржЗржи ржХрж░рж╛рж░ ржЬржирзНржп ржПржХржЯрж╛ secret keyред
# ржПржЯрж╛ ржжрж┐ржпрж╝рзЗ token рждрзИрж░рж┐ рж╣ржпрж╝ ржПржмржВ verify рж╣ржпрж╝ред
# ржЙржжрж╛рж╣рж░ржг: "supersecretaccess" (production-ржП ржЕржирзЗржХ ржЬржЯрж┐рж▓ рж╣ржмрзЗ)

JWT_REFRESH_SECRET=
# Refresh Token ржПрж░ ржЬржирзНржп ржЖрж▓рж╛ржжрж╛ secret keyред
# (ржПржЗ ржкрзНрж░ржЬрзЗржХрзНржЯрзЗ ржмрзНржпржмрж╣рзГржд рж╣ржпрж╝ржирж┐, ржнржмрж┐рж╖рзНржпрждрзЗрж░ ржЬржирзНржп рж░рж╛ржЦрж╛)

ACCESS_TOKEN_EXPIRES=15m
# Access Token ржХрждржХрзНрж╖ржг ржмрзИржз ржерж╛ржХржмрзЗред 15m = рззрзл ржорж┐ржирж┐ржЯред

REFRESH_TOKEN_EXPIRES=7d
# Refresh Token ржХрждржжрж┐ржи ржмрзИржз ржерж╛ржХржмрзЗред 7d = рзн ржжрж┐ржиред

NODE_ENV=
# ржЕрзНржпрж╛ржк ржХрзЛржи ржкрж░рж┐ржмрзЗрж╢рзЗ ржЪрж▓ржЫрзЗ: development / stage / production
# development = ржбрзЗржнрзЗрж▓ржкрж╛рж░рзЗрж░ ржХржорзНржкрж┐ржЙржЯрж╛рж░ (debug mode)
# stage = ржЯрзЗрж╕рзНржЯ рж╕рж╛рж░рзНржнрж╛рж░
# production = ржЖрж╕рж▓ рж╕рж╛рж░рзНржнрж╛рж░ (ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржжрзЗрж░ ржЬржирзНржп)

DATABASE_URL=mysql://user:password@host:3306/db_name
# Prisma ORM ржПржЗ full URL ржжрж┐ржпрж╝рзЗ database-ржП connect ржХрж░рзЗред
# ржлрж░рзНржорзНржпрж╛ржЯ: protocol://username:password@host:port/database_name

BACKEND_URL=http://localhost:5100
# Backend API-ржПрж░ ржкрзВрж░рзНржг URLред
```

## ЁЯУД `.env` тАФ ржЖрж╕рж▓ ржЧрзЛржкржи ржорж╛ржи

`.env` ржлрж╛ржЗрж▓рзЗ ржЖрж╕рж▓ credentials ржерж╛ржХрзЗред **ржПржЯрж╛ ржХржЦржирзЛ GitHub-ржП push ржХрж░ржмрзЗ ржирж╛!**

```bash
# ржЖрж╕рж▓ .env ржлрж╛ржЗрж▓рзЗ ржПржЗ ржзрж░ржирзЗрж░ ржорж╛ржи ржерж╛ржХрзЗ:
PORT=5100
DATABASE_USER=root
DATABASE_PASSWORD=password       # тЖР ржЖрж╕рж▓ password!
JWT_ACCESS_SECRET=supersecretaccess  # тЖР ржЖрж╕рж▓ secret key!
```

## ЁЯУД `.gitignore` тАФ Git ржерзЗржХрзЗ ржмрж╛ржж

```bash
node_modules           # npm packages (git-ржП ржжрж░ржХрж╛рж░ ржирзЗржЗ, npm install ржжрж┐рж▓рзЗржЗ ржЖржмрж╛рж░ рж╣ржмрзЗ)
.env                   # ржЧрзЛржкржи рждржерзНржп тАФ ржПржЯрж╛ git-ржП ржЧрзЗрж▓рзЗ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ рж░рж┐рж╕рзНржХ!
/src/generated/prisma  # Prisma auto-generate ржХрж░рж╛ ржХрзЛржб
```

### ЁЯПа ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг

`.env` ржлрж╛ржЗрж▓ = рждрзЛржорж╛рж░ **ржмрж╛рж╕рж╛рж░ ржЪрж╛ржмрж┐**ред ржЪрж╛ржмрж┐ рж╕ржмрж╛ржЗржХрзЗ ржжрзЗржЦрж╛ржУ ржирж╛, ржЖрж▓ржорж╛рж░рж┐рждрзЗ рж░рж╛ржЦрзЛред
`.env.example` = ржЪрж╛ржмрж┐рж░ **ржЫржмрж┐**ред ржирждрзБржи ржХрзЗржЙ ржЖрж╕рж▓рзЗ ржмрзБржЭрждрзЗ ржкрж╛рж░ржмрзЗ ржХрзЗржоржи ржЪрж╛ржмрж┐ ржмрж╛ржирж╛рждрзЗ рж╣ржмрзЗред
`.gitignore` = **"ржПржЗ ржЬрж┐ржирж┐рж╕ржЧрзБрж▓рзЛ ржЕржлрж┐рж╕рзЗ ржирж┐ржпрж╝рзЗ ржпрзЗржУ ржирж╛"** рж▓рж┐рж╕рзНржЯред

---

# ржЕржзрзНржпрж╛ржпрж╝ рзй: Package ржУ Dependencies

## ЁЯУД `package.json` тАФ рж▓рж╛ржЗржи-ржмрж╛ржЗ-рж▓рж╛ржЗржи

```json
{
  "name": "auth-service",       // ржкрзНрж░ржЬрзЗржХрзНржЯрзЗрж░ ржирж╛ржо
  "version": "1.0.0",           // ржнрж╛рж░рзНрж╕ржи ржиржорзНржмрж░
  "main": "index.js",           // ржорзВрж▓ entry point (ржПржЦрж╛ржирзЗ server.js ржмрзНржпржмрж╣рж╛рж░ рж╣ржЪрзНржЫрзЗ)
```

### Scripts (ржХржорж╛ржирзНржб рж╢рж░рзНржЯржХрж╛ржЯ)

```json
"scripts": {
    "dev": "nodemon src/server.js",
    // ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯрзЗ ржмрзНржпржмрж╣рж╛рж░ рж╣ржпрж╝ред nodemon ржлрж╛ржЗрж▓ ржкрж░рж┐ржмрж░рзНрждржи рж╣рж▓рзЗ ржЖржкржирж╛ржЖржкржирж┐ рж╕рж╛рж░рзНржнрж╛рж░ рж░рж┐рж╕рзНржЯрж╛рж░рзНржЯ ржХрж░рзЗред
    // ЁЯПа ржЙржжрж╛рж╣рж░ржг: ржХрзНржпрж╛ржорзЗрж░рж╛ржпрж╝ motion detect-ржПрж░ ржорждрзЛ тАФ ржиржбрж╝рж╛ржЪржбрж╝рж╛ рж╣рж▓рзЗржЗ рж░рзЗржХрж░рзНржб рж╢рзБрж░рзБ!

    "start": "node src/server.js",
    // Production-ржП ржмрзНржпржмрж╣рж╛рж░ рж╣ржпрж╝ред рж╕рж╛ржзрж╛рж░ржг node ржжрж┐ржпрж╝рзЗ рж╕рж╛рж░рзНржнрж╛рж░ ржЪрж╛рж▓рж╛ржпрж╝ред

    "prisma:generate": "prisma generate",
    // Schema ржерзЗржХрзЗ Prisma Client ржХрзЛржб рждрзИрж░рж┐ ржХрж░рзЗ (TypeScript types, query functions)

    "prisma:migrate": "prisma migrate dev",
    // Database-ржП ржирждрзБржи table/column рждрзИрж░рж┐ ржХрж░рзЗ (development)

    "prisma:deploy": "prisma migrate deploy",
    // Production database-ржП migration apply ржХрж░рзЗ

    "lint": "eslint .",
    // ржХрзЛржбрзЗрж░ ржнрзБрж▓/рж╕рзНржЯрж╛ржЗрж▓ рж╕ржорж╕рзНржпрж╛ ржЦрзБржБржЬрзЗ ржмрзЗрж░ ржХрж░рзЗ

    "test": "jest"
    // ржЯрзЗрж╕рзНржЯ рж░рж╛ржи ржХрж░рзЗ
}
```

### Dependencies (ржорзВрж▓ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржкрзНржпрж╛ржХрзЗржЬ)

| Package                   | ржХрж╛ржЬ                                     | ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг                          |
| ------------------------- | --------------------------------------- | -------------------------------------- |
| `express` (v5)            | Web framework тАФ HTTP request handle ржХрж░рзЗ | рж░рзЗрж╕рзНржЯрзБрж░рзЗржирзНржЯрзЗрж░ main kitchen             |
| `@prisma/client`          | Database-ржП query ржХрж░рзЗ (ORM)              | рж╕рзНржЯрзЛрж░ рж░рзБржорзЗрж░ ржорзНржпрж╛ржирзЗржЬрж╛рж░                  |
| `@prisma/adapter-mariadb` | MySQL/MariaDB-ржПрж░ рж╕рж╛ржерзЗ connect ржХрж░рзЗ       | рж╕рзНржЯрзЛрж░ рж░рзБржорзЗрж░ ржжрж░ржЬрж╛рж░ ржЪрж╛ржмрж┐                 |
| `prisma`                  | Schema, migration manage ржХрж░рзЗ            | рж╕рзНржЯрзЛрж░ рж░рзБржорзЗрж░ ржиржХрж╢рж╛ ржмрж╛ржирж╛ржпрж╝                |
| `bcryptjs`                | Password hash ржХрж░рзЗ (encrypt)             | ржЪрж┐ржарж┐ рж╕рж┐рж▓ржорзЛрж╣рж░ ржжрж┐ржпрж╝рзЗ ржмржирзНржз ржХрж░рж╛            |
| `jsonwebtoken` (JWT)      | Token рждрзИрж░рж┐ ржУ verify ржХрж░рзЗ                 | ржнрж┐ржЬрж┐ржЯрж░ ржкрж╛рж╕ ржЫрж╛ржкрж╛ржирзЛрж░ ржорзЗрж╢рж┐ржи               |
| `cookie-parser`           | Browser cookie ржкржбрж╝рзЗ                     | ржЪрж┐ржарж┐рж░ ржЦрж╛ржо ржЦрзЛрж▓рж╛рж░ ржХрж╛ржБржЪрж┐                  |
| `cors`                    | ржЕржирзНржп domain ржерзЗржХрзЗ request allow ржХрж░рзЗ      | ржмрж┐ржжрзЗрж╢рж┐ ржнрж┐рж╕рж╛ ржжрзЗржУржпрж╝рж╛рж░ ржЕржлрж┐рж╕               |
| `helmet`                  | HTTP headers-ржП security ржпрзЛржЧ ржХрж░рзЗ         | рж╣рзЗрж▓ржорзЗржЯ ржкрж░рж╛ = ржорж╛ржерж╛ рж╕рзБрж░ржХрзНрж╖рж╛              |
| `express-rate-limit`      | ржЕрждрж┐рж░рж┐ржХрзНржд request ржмрзНрж▓ржХ ржХрж░рзЗ               | "рзз ржШржгрзНржЯрж╛ржпрж╝ рззрзж ржмрж╛рж░рзЗрж░ ржмрзЗрж╢рж┐ ржврзЛржХрж╛ ржпрж╛ржмрзЗ ржирж╛" |
| `dotenv`                  | `.env` ржлрж╛ржЗрж▓ ржерзЗржХрзЗ variable ржкржбрж╝рзЗ          | ржЖрж▓ржорж╛рж░рж┐ ржерзЗржХрзЗ ржЪрж╛ржмрж┐ ржмрзЗрж░ ржХрж░рж╛               |
| `uuid`                    | Unique ID рждрзИрж░рж┐ ржХрж░рзЗ                      | ржкрзНрж░рждрж┐ржЯрж╛ ржорж╛ржирзБрж╖рзЗрж░ NID ржиржорзНржмрж░              |

### DevDependencies (рж╢рзБржзрзБ development-ржП рж▓рж╛ржЧрзЗ)

| Package                 | ржХрж╛ржЬ                                 |
| ----------------------- | ----------------------------------- |
| `nodemon`               | ржлрж╛ржЗрж▓ ржкрж░рж┐ржмрж░рзНрждржирзЗ auto-restart         |
| `eslint` + `@eslint/js` | ржХрзЛржб quality check                   |
| `globals`               | ESLint-ржПрж░ ржЬржирзНржп global variable list |
| `jest`                  | ржЯрзЗрж╕рзНржЯ framework                     |

---

# ржЕржзрзНржпрж╛ржпрж╝ рзк: Database тАФ Prisma ORM

## ЁЯдФ Prisma ORM ржХрзА?

ORM = **Object-Relational Mapping**ред рж╕рж╣ржЬ ржХржерж╛ржпрж╝, рждрзБржорж┐ SQL рж▓рзЗржЦрж╛рж░ ржмржжрж▓рзЗ JavaScript-ржП database-ржПрж░ ржХрж╛ржЬ ржХрж░рждрзЗ ржкрж╛рж░рзЛред

```javascript
// SQL ржжрж┐ржпрж╝рзЗ ржХрж░рж▓рзЗ:
// SELECT * FROM User WHERE email = 'test@mail.com';

// Prisma ржжрж┐ржпрж╝рзЗ ржХрж░рж▓рзЗ (JavaScript):
const user = await prisma.user.findUnique({
  where: { email: "test@mail.com" },
});
// ржжрзБржЯрзЛржЗ ржПржХржЗ ржХрж╛ржЬ ржХрж░рзЗ, ржХрж┐ржирзНрждрзБ Prisma-рждрзЗ ржнрзБрж▓ рж╣ржУржпрж╝рж╛рж░ рж╕ржорзНржнрж╛ржмржирж╛ ржХржо!
```

## ЁЯУД `prisma/schema.prisma` тАФ рж▓рж╛ржЗржи-ржмрж╛ржЗ-рж▓рж╛ржЗржи

```prisma
generator client {
  provider = "prisma-client"
  // Prisma Client code generate ржХрж░ржмрзЗ тАФ ржПржЯрж╛ ржжрж┐ржпрж╝рзЗ рждрзБржорж┐ JS-ржП database query рж▓рж┐ржЦржмрзЗ
  output   = "../generated/prisma"
  // Generated code ржХрзЛржерж╛ржпрж╝ ржЬржорж╛ рж╣ржмрзЗ
}

datasource db {
  provider = "mysql"
  // ржХрзЛржи database ржмрзНржпржмрж╣рж╛рж░ рж╣ржмрзЗ (MySQL)
}
```

### User Model (ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржЯрзЗржмрж┐рж▓)

```prisma
model User {
  id            String   @id @default(uuid())
  // id = ржкрзНрж░рждрж┐ржЯрж╛ ржЗржЙржЬрж╛рж░рзЗрж░ unique ржкрж░рж┐ржЪржпрж╝ржкрждрзНрж░
  // @id = ржПржЯрж╛ primary key (ржорзВрж▓ ржЪрж╛ржмрж┐)
  // @default(uuid()) = ржЖржкржирж╛ржЖржкржирж┐ ржПржХржЯрж╛ unique ID рждрзИрж░рж┐ рж╣ржмрзЗ
  // ржЙржжрж╛рж╣рж░ржг: "550e8400-e29b-41d4-a716-446655440000"

  email         String   @unique
  // email = ржЗржорзЗржЗрж▓ ржарж┐ржХрж╛ржирж╛
  // @unique = ржжрзБржЬржи ржЗржЙржЬрж╛рж░рзЗрж░ ржПржХржЗ ржЗржорзЗржЗрж▓ рж╣рждрзЗ ржкрж╛рж░ржмрзЗ ржирж╛
  // ржЙржжрж╛рж╣рж░ржг: "reza@gmail.com"

  passwordHash  String
  // ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржбрзЗрж░ рж╣рзНржпрж╛рж╢ (encrypted) ржнрж╛рж░рзНрж╕ржи рж╕ржВрж░ржХрзНрж╖рж┐ржд рж╣ржпрж╝
  // ржХржЦржирзЛ plain password ржЬржорж╛ рж░рж╛ржЦржмрзЗ ржирж╛! (ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржЭрзБржБржХрж┐)

  role          Role     @default(USER)
  // ржЗржЙржЬрж╛рж░рзЗрж░ ржнрзВржорж┐ржХрж╛: USER ржЕржержмрж╛ ADMIN
  // @default(USER) = ржирждрзБржи ржЗржЙржЬрж╛рж░ by default рж╕рж╛ржзрж╛рж░ржг USER рж╣ржмрзЗ

  tokenVersion  Int      @default(0)
  // ржЯрзЛржХрзЗржи ржнрж╛рж░рзНрж╕ржи ржиржорзНржмрж░ тАФ force logout ржХрж░рждрзЗ ржмрзНржпржмрж╣рж╛рж░ рж╣ржпрж╝
  // ржПржЯрж╛ ржмрж╛ржбрж╝рж╛рж▓рзЗ ржкрзБрж░ржирзЛ рж╕ржм token ржЕржХрзЗржЬрзЛ рж╣ржпрж╝рзЗ ржпрж╛ржпрж╝
  // ЁЯПа ржЙржжрж╛рж╣рж░ржг: ржкрж╛рж╕ржкрзЛрж░рзНржЯ ржиржорзНржмрж░ ржкрж░рж┐ржмрж░рзНрждржи тАФ ржкрзБрж░ржирзЛ ржкрж╛рж╕ржкрзЛрж░рзНржЯ ржЖрж░ ржХрж╛ржЬ ржХрж░ржмрзЗ ржирж╛

  createdAt     DateTime @default(now())
  // ржХржмрзЗ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ рждрзИрж░рж┐ рж╣ржпрж╝рзЗржЫрзЗ

  updatedAt     DateTime @updatedAt
  // рж╕рж░рзНржмрж╢рзЗрж╖ ржХржмрзЗ ржЖржкржбрзЗржЯ рж╣ржпрж╝рзЗржЫрзЗ (Prisma ржЖржкржирж╛ржЖржкржирж┐ рж╕рзЗржЯ ржХрж░рзЗ)

  refreshTokens RefreshToken[]
  // ржПржЗ ржЗржЙржЬрж╛рж░рзЗрж░ рж╕ржм refresh token-ржПрж░ рждрж╛рж▓рж┐ржХрж╛
  // ржПржХржЬржи ржЗржЙржЬрж╛рж░рзЗрж░ ржПржХрж╛ржзрж┐ржХ ржбрж┐ржнрж╛ржЗрж╕рзЗ login ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗ

  @@index([email])
  // email field-ржП index тАФ search ржжрзНрж░рзБржд рж╣ржпрж╝
  // ЁЯПа ржЙржжрж╛рж╣рж░ржг: ржмржЗржпрж╝рзЗрж░ рж╕рзВржЪрж┐ржкрждрзНрж░ тАФ рж╕рзВржЪрж┐ ржерж╛ржХрж▓рзЗ ржкрзЗржЬ ржЦрзБржБржЬрзЗ ржкрзЗрждрзЗ рж╕рж╣ржЬ
}
```

### RefreshToken Model (рж░рж┐ржлрзНрж░рзЗрж╢ ржЯрзЛржХрзЗржи ржЯрзЗржмрж┐рж▓)

```prisma
model RefreshToken {
  id         String   @id @default(uuid())
  // ржкрзНрж░рждрж┐ржЯрж╛ refresh token-ржПрж░ unique ID

  userId     String
  // ржХрзЛржи ржЗржЙржЬрж╛рж░рзЗрж░ token тАФ User ржЯрзЗржмрж┐рж▓рзЗрж░ id-ржПрж░ рж╕рж╛ржерзЗ рж╕ржорзНржкрж░рзНржХрж┐ржд

  tokenHash  String
  // Token-ржПрж░ рж╣рзНржпрж╛рж╢ (encrypted) ржнрж╛рж░рзНрж╕ржи
  // ржЖрж╕рж▓ token database-ржП рж░рж╛ржЦрж╛ рж╣ржпрж╝ ржирж╛ (ржирж┐рж░рж╛ржкрждрзНрждрж╛!)

  expiresAt  DateTime
  // ржХржмрзЗ expire рж╣ржмрзЗ (рзн ржжрж┐ржи ржкрж░рзЗ)

  isRevoked  Boolean  @default(false)
  // token ржмрж╛рждрж┐рж▓ рж╣ржпрж╝рзЗржЫрзЗ ржХрж┐ржирж╛
  // logout ржХрж░рж▓рзЗ ржПржЯрж╛ true рж╣ржпрж╝

  createdAt  DateTime @default(now())

  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  // User-ржПрж░ рж╕рж╛ржерзЗ рж╕ржорзНржкрж░рзНржХ
  // onDelete: Cascade = User ржорзБржЫрзЗ ржЧрзЗрж▓рзЗ рждрж╛рж░ рж╕ржм token-ржУ ржорзБржЫрзЗ ржпрж╛ржмрзЗ

  @@index([userId])
  // userId-рждрзЗ index тАФ ржжрзНрж░рзБржд search
}

enum Role {
  USER     // рж╕рж╛ржзрж╛рж░ржг ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА
  ADMIN    // ржЕрзНржпрж╛ржбржорж┐ржи (ржмрж┐рж╢рзЗрж╖ ржХрзНрж╖ржорждрж╛ ржЖржЫрзЗ)
}
```

### ЁЯПа ржжрзБржЗ ржЯрзЗржмрж┐рж▓рзЗрж░ рж╕ржорзНржкрж░рзНржХ ржмрзБржЭрж┐

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР         тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ      User        тФВ         тФВ   RefreshToken   тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд         тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ id (PK)          тФВтЖРтФАтФАтФАтФАтФАтФАтФАтФАтФВ userId (FK)      тФВ
тФВ email            тФВ    1:N  тФВ id (PK)          тФВ
тФВ passwordHash     тФВ         тФВ tokenHash        тФВ
тФВ role             тФВ         тФВ expiresAt        тФВ
тФВ tokenVersion     тФВ         тФВ isRevoked        тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ         тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ

1:N ржорж╛ржирзЗ = ржПржХржЬржи User-ржПрж░ ржЕржирзЗржХржЧрзБрж▓рзЛ RefreshToken ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗ
(ржлрзЛржи, рж▓рзНржпрж╛ржкржЯржк, ржЯрзНржпрж╛ржмрж▓рзЗржЯ тАФ ржкрзНрж░рждрж┐ржЯрж╛ ржбрж┐ржнрж╛ржЗрж╕рзЗ ржЖрж▓рж╛ржжрж╛ token)
```

## ЁЯУД `prisma.config.ts` тАФ Prisma ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи

```typescript
import "dotenv/config";
// .env ржлрж╛ржЗрж▓ ржерзЗржХрзЗ environment variables рж▓рзЛржб ржХрж░рзЗ

import { defineConfig, env } from "prisma/config";

export default defineConfig({
  schema: "prisma/schema.prisma",
  // Schema ржлрж╛ржЗрж▓рзЗрж░ ржкрже

  migrations: {
    path: "prisma/migrations",
    // Migration ржлрж╛ржЗрж▓ржЧрзБрж▓рзЛ ржХрзЛржерж╛ржпрж╝ ржерж╛ржХржмрзЗ
  },

  datasource: {
    url: env("DATABASE_URL"),
    // .env ржерзЗржХрзЗ DATABASE_URL ржкржбрж╝рзЗ database-ржП connect ржХрж░ржмрзЗ
  },
});
```

## ЁЯУД `src/config/prisma.js` тАФ Database Connection

```javascript
import "dotenv/config";
// .env ржлрж╛ржЗрж▓ рж▓рзЛржб (DATABASE_HOST, DATABASE_USER ржЗрждрзНржпрж╛ржжрж┐ ржкрзЗрждрзЗ)

import { PrismaMariaDb } from "@prisma/adapter-mariadb";
// MariaDB/MySQL adapter тАФ Prisma ржХрзЗ MySQL-ржПрж░ рж╕рж╛ржерзЗ ржХржерж╛ ржмрж▓рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗ

import { PrismaClient } from "@prisma/client";
// PrismaClient тАФ ржПржЯрж╛ ржжрж┐ржпрж╝рзЗ database query ржХрж░ржмрзЛ

const adapter = new PrismaMariaDb({
  host: process.env.DATABASE_HOST, // ржХрзЛржерж╛ржпрж╝ database ржЖржЫрзЗ (db)
  user: process.env.DATABASE_USER, // username (root)
  password: process.env.DATABASE_PASSWORD, // password
  database: process.env.DATABASE_NAME, // database name (authdb)
  connectionLimit: 5, // рж╕рж░рзНржмрзЛржЪрзНржЪ рзлржЯрж╛ connection ржПржХрж╕рж╛ржерзЗ
  // ЁЯПа ржЙржжрж╛рж╣рж░ржг: ржмрзНржпрж╛ржВржХрзЗрж░ рзлржЯрж╛ ржХрж╛ржЙржирзНржЯрж╛рж░ тАФ ржПржХрж╕рж╛ржерзЗ рзл ржЬржи рж╕рзЗржмрж╛ ржкрж╛ржмрзЗ
});

const prisma = new PrismaClient({ adapter });
// adapter ржжрж┐ржпрж╝рзЗ PrismaClient рждрзИрж░рж┐ тАФ ржПржЯрж╛ржЗ рж╕ржм query-рждрзЗ ржмрзНржпржмрж╣рж╛рж░ рж╣ржмрзЗ

export { prisma };
```

### Migration ржХрзА?

Migration рж╣рж▓рзЛ database-ржПрж░ **ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ ржЗрждрж┐рж╣рж╛рж╕**ред ржкрзНрж░рждрж┐ржмрж╛рж░ ржпржЦржи schema-рждрзЗ ржХрж┐ржЫрзБ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзЛ (ржирждрзБржи field, ржирждрзБржи table), Prisma ржПржХржЯрж╛ migration ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рзЗ ржпрзЗржЦрж╛ржирзЗ SQL ржХржорж╛ржирзНржб ржерж╛ржХрзЗред

**ржЙржжрж╛рж╣рж░ржг**: ржмрж╛рж╕рж╛рж░ ржиржХрж╢рж╛ ржкрж░рж┐ржмрж░рзНрждржирзЗрж░ рж░рзЗржХрж░рзНржб тАФ "рждрж╛рж░рж┐ржЦ X-ржП ржирждрзБржи ржШрж░ ржпрзЛржЧ рж╣рж▓рзЛ", "рждрж╛рж░рж┐ржЦ Y-рждрзЗ ржмрж╛рж░рж╛ржирзНржжрж╛ ржмржбрж╝ рж╣рж▓рзЛ"

```bash
npm run prisma:migrate   # development-ржП migration рждрзИрж░рж┐ ржУ apply
npm run prisma:deploy    # production-ржП рж╢рзБржзрзБ apply (ржирждрзБржи migration рждрзИрж░рж┐ ржиржпрж╝)
```

---

# ржЕржзрзНржпрж╛ржпрж╝ рзл: ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржПржирзНржЯрзНрж░рж┐ ржкржпрж╝рзЗржирзНржЯ

## ЁЯУД `src/server.js` тАФ рж╕рж╛рж░рзНржнрж╛рж░ ржЪрж╛рж▓рзБ

```javascript
const app = require("./app");
// app.js ржерзЗржХрзЗ рждрзИрж░рж┐ Express application ржЖржирзЛ

const PORT = process.env.PORT || 5000;
// .env ржерзЗржХрзЗ PORT ржкржбрж╝рзЛ, ржирж╛ ржкрзЗрж▓рзЗ 5000 ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛуАВ
// || ржорж╛ржирзЗ "ржЕржержмрж╛" тАФ ржмрж╛ржо ржкрж╛рж╢рзЗ ржирж╛ ржкрзЗрж▓рзЗ ржбрж╛ржи ржкрж╛рж╢рзЗрж░ржЯрж╛ ржирж╛ржУ

app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});
// рж╕рж╛рж░рзНржнрж╛рж░ ржЪрж╛рж▓рзБ ржХрж░рзЛ ржПржмржВ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ port-ржП listen ржХрж░рзЛ
// ЁЯПа ржЙржжрж╛рж╣рж░ржг: ржжрзЛржХрж╛ржи ржЦрзБрж▓рж▓рзЗ тАФ "ржжрзЛржХрж╛ржи рзлрззрзжрзж ржиржорзНржмрж░ ржарж┐ржХрж╛ржирж╛ржпрж╝ ржЪрж╛рж▓рзБ!"
```

## ЁЯУД `src/app.js` тАФ Express App рж╕рзЗржЯржЖржк (рж▓рж╛ржЗржи-ржмрж╛ржЗ-рж▓рж╛ржЗржи)

```javascript
const express = require("express");
// Express framework ржЖржирзЛ тАФ ржПржЯрж╛ HTTP request handle ржХрж░рзЗ

const cors = require("cors");
// CORS = Cross-Origin Resource Sharing
// ржЕржирзНржп domain (ржпрзЗржоржи frontend) ржерзЗржХрзЗ API call ржХрж░рждрзЗ ржжрзЗржпрж╝
// ЁЯПа ржЙржжрж╛рж╣рж░ржг: ржЕржирзНржп ржжрзЗрж╢ ржерзЗржХрзЗ ржЖрж╕рж╛ ржорж╛ржирзБрж╖ржХрзЗ ржнрж┐рж╕рж╛ ржжрзЗржУржпрж╝рж╛

const helmet = require("helmet");
// HTTP headers-ржП security ржпрзЛржЧ ржХрж░рзЗ
// ЁЯПа ржЙржжрж╛рж╣рж░ржг: ржорзЛржЯрж░рж╕рж╛ржЗржХрзЗрж▓рзЗ рж╣рзЗрж▓ржорзЗржЯ = ржорж╛ржерж╛ рж╕рзБрж░ржХрзНрж╖рж╛

const cookieParser = require("cookie-parser");
// Request-ржПрж░ cookie ржкржбрж╝рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗ (refresh token cookie-рждрзЗ ржерж╛ржХрзЗ)

const authRoutes = require("./modules/auth/auth.routes");
// Auth module-ржПрж░ routes ржЖржирзЛ

const errorMiddleware = require("./middlewares/error.middleware");
// Global error handler

const { prisma } = require("./config/prisma");
// Database connection (graceful shutdown-ржП рж▓рж╛ржЧржмрзЗ)

const app = express();
// Express app рждрзИрж░рж┐ ржХрж░рзЛ

require("dotenv").config();
// .env ржлрж╛ржЗрж▓ ржерзЗржХрзЗ рж╕ржм variable рж▓рзЛржб ржХрж░рзЛ
```

### Middleware рж╕рзЗржЯржЖржк

```javascript
app.use(helmet());
// рж╕ржм response-ржП security headers ржпрзЛржЧ ржХрж░рзЛ
// ржпрзЗржоржи: X-Content-Type-Options, X-Frame-Options ржЗрждрзНржпрж╛ржжрж┐

app.use(cors());
// рж╕ржм origin ржерзЗржХрзЗ request allow ржХрж░рзЛ (production-ржП ржирж┐рж░рзНржжрж┐рж╖рзНржЯ domain ржжрж┐рждрзЗ рж╣ржмрзЗ)

app.disable("x-powered-by");
// "X-Powered-By: Express" header рж╕рж░рж┐ржпрж╝рзЗ ржжрж╛ржУ
// ржХрж╛рж░ржг: рж╣рзНржпрж╛ржХрж╛рж░рж░рж╛ ржЬрж╛ржирзБржХ ржирж╛ рждрзБржорж┐ ржХрзЛржи framework ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрзЛ

app.use(express.json({ limit: "10kb" }));
// JSON body parse ржХрж░рзЛ, рж╕рж░рзНржмрзЛржЪрзНржЪ 10KB
// ЁЯЫбя╕П ржирж┐рж░рж╛ржкрждрзНрждрж╛: ржХрзЗржЙ рззрзжрзж MB JSON ржкрж╛ржарж┐ржпрж╝рзЗ рж╕рж╛рж░рзНржнрж╛рж░ ржХрзНрж░рзНржпрж╛рж╢ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ ржирж╛

app.use(cookieParser());
// Cookie parse ржХрж░рзЛ (refresh token cookie ржерзЗржХрзЗ ржкржбрж╝рждрзЗ рж╣ржмрзЗ)

app.use(errorMiddleware);
// ржпрзЗржХрзЛржирзЛ error рж╣рж▓рзЗ ржПржЗ middleware handle ржХрж░ржмрзЗ
```

### Routes

```javascript
app.get("/health", (req, res) => {
  res.status(200).json({
    status: "ok",
    uptime: process.uptime(),
    // рж╕рж╛рж░рзНржнрж╛рж░ ржХрждржХрзНрж╖ржг ржзрж░рзЗ ржЪрж▓ржЫрзЗ (рж╕рзЗржХрзЗржирзНржбрзЗ)
  });
});
// Health check endpoint тАФ рж╕рж╛рж░рзНржнрж╛рж░ ржмрзЗржБржЪрзЗ ржЖржЫрзЗ ржХрж┐ржирж╛ ржЬрж╛ржирждрзЗ
// Docker HEALTHCHECK ржПржЗ endpoint ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ
// ЁЯПа ржЙржжрж╛рж╣рж░ржг: ржбрж╛ржХрзНрждрж╛рж░ рж░рзЛржЧрзАрж░ pulse ржЪрзЗржХ ржХрж░рж╛рж░ ржорждрзЛ

app.use("/api/v1/auth", authRoutes);
// /api/v1/auth ржжрж┐ржпрж╝рзЗ рж╢рзБрж░рзБ рж╣ржУржпрж╝рж╛ рж╕ржм request auth module-ржП ржпрж╛ржмрзЗ
// /api/v1/ тАФ API versioning (ржнржмрж┐рж╖рзНржпрждрзЗ v2 ржмрж╛ржирж╛рж▓рзЗ ржкрзБрж░ржирзЛ v1 ржХрж╛ржЬ ржХрж░ржмрзЗ)
```

### Graceful Shutdown

```javascript
process.on("SIGTERM", async () => {
  console.log("Shutting down...");
  await prisma.$disconnect();
  // Database connection ржмржирзНржз ржХрж░рзЛ
  process.exit(0);
  // рж╕рж╛рж░рзНржнрж╛рж░ ржмржирзНржз ржХрж░рзЛ
});
// SIGTERM = рж╕рж╛рж░рзНржнрж╛рж░ ржмржирзНржз ржХрж░рж╛рж░ рж╕рж┐ржЧржирзНржпрж╛рж▓ (Docker stop ржкрж╛ржарж╛ржпрж╝)
// ЁЯПа ржЙржжрж╛рж╣рж░ржг: ржжрзЛржХрж╛ржи ржмржирзНржз ржХрж░рж╛рж░ ржЖржЧрзЗ рж╕ржм ржХрж╛рж╕рзНржЯржорж╛рж░ржХрзЗ serve ржХрж░рзЗ рждрж╛рж░ржкрж░ ржмржирзНржз ржХрж░рзЛ
// рж╣ржарж╛рзО ржмржирзНржз ржХрж░рж▓рзЗ ржХрж╛рж╕рзНржЯржорж╛рж░ ржХрзНрж╖рждрж┐ржЧрзНрж░рж╕рзНржд рж╣ржмрзЗ!

module.exports = app;
// ржЕржирзНржп ржлрж╛ржЗрж▓рзЗ ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржЬржирзНржп export
```

---

# ржЕржзрзНржпрж╛ржпрж╝ рзм: Utilities тАФ Hash ржУ Token

## ЁЯУД `src/utils/hash.js` тАФ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж╕рзБрж░ржХрзНрж╖рж╛

```javascript
const bcrypt = require("bcryptjs");
// bcrypt = ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб hash ржХрж░рж╛рж░ industry-standard library

const SALT_ROUNDS = 12;
// Salt = hash-ржП random data ржпрзЛржЧ ржХрж░рж╛ (ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржмрж╛ржбрж╝рж╛ржпрж╝)
// 12 rounds = 2^12 = 4096 ржмрж╛рж░ hash рж╣ржмрзЗ
// ржмрзЗрж╢рж┐ round = ржмрзЗрж╢рж┐ ржирж┐рж░рж╛ржкржж, ржХрж┐ржирзНрждрзБ ржмрзЗрж╢рж┐ рж╕ржоржпрж╝ рж▓рж╛ржЧрзЗ
// ЁЯПа ржЙржжрж╛рж╣рж░ржг: рждрж╛рж▓рж╛ рждрзИрж░рж┐рждрзЗ рззрзи рж╕рзНрждрж░рзЗрж░ ржЬржЯрж┐рж▓рждрж╛

const hashPassword = async (plainPassword) => {
  return bcrypt.hash(plainPassword, SALT_ROUNDS);
};
// "mypass123" тЖТ "$2a$12$LJ3m4ys..." (ржПржХржорзБржЦрзА рж░рзВржкрж╛ржирзНрждрж░, ржлрзЗрж░ржд ржЖржирж╛ ржпрж╛ржпрж╝ ржирж╛)
// ЁЯПа ржЙржжрж╛рж╣рж░ржг: ржорж╛ржВрж╕рзЗрж░ ржХрж┐ржорж╛ тАФ ржорж╛ржВрж╕ ржерзЗржХрзЗ ржХрж┐ржорж╛ рж╣ржпрж╝, ржХрж┐ржирзНрждрзБ ржХрж┐ржорж╛ ржерзЗржХрзЗ ржорж╛ржВрж╕ ржлрзЗрж░ржд ржЖрж╕рзЗ ржирж╛!

const comparePassword = async (plainPassword, hash) => {
  return bcrypt.compare(plainPassword, hash);
};
// Login-ржПрж░ рж╕ржоржпрж╝: "mypass123" ржЖрж░ рж╣рзНржпрж╛рж╢ ржХрж░рж╛ password ржорзЗрж▓рзЗ ржХрж┐ржирж╛ ржЪрзЗржХ ржХрж░рзЗ
// true = ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб рж╕ржарж┐ржХ, false = ржнрзБрж▓

module.exports = { hashPassword, comparePassword };
```

### тЪая╕П ржХрзЗржи plain password ржЬржорж╛ рж░рж╛ржЦрж╛ ржпрж╛ржпрж╝ ржирж╛?

```
тЭМ ржнрзБрж▓ ржкржжрзНржзрждрж┐: Database-ржП password = "mypass123"
   тЖТ рж╣рзНржпрж╛ржХрж╛рж░ database ржкрзЗрж▓рзЗржЗ рж╕ржм password ржкрзЗржпрж╝рзЗ ржпрж╛ржмрзЗ!

тЬЕ рж╕ржарж┐ржХ ржкржжрзНржзрждрж┐: Database-ржП passwordHash = "$2a$12$LJ3m4ys..."
   тЖТ рж╣рзНржпрж╛ржХрж╛рж░ hash ржкрзЗрж▓рзЗржУ ржЖрж╕рж▓ password ржмрзЗрж░ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ ржирж╛!
```

## ЁЯУД `src/utils/token.js` тАФ JWT ржУ Refresh Token

```javascript
const jwt = require("jsonwebtoken");
// JWT = JSON Web Token тАФ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ ржЪрж┐ржирждрзЗ ржмрзНржпржмрж╣рж╛рж░ рж╣ржпрж╝
const crypto = require("crypto");
// Node.js-ржПрж░ built-in cryptography module

const generateAccessToken = (payload) => {
  return jwt.sign(payload, process.env.JWT_ACCESS_SECRET, {
    expiresIn: process.env.ACCESS_TOKEN_EXPIRES, // 15 ржорж┐ржирж┐ржЯ
  });
};
// Access Token рждрзИрж░рж┐ ржХрж░рзЗ
// payload = { userId, role, tokenVersion } тАФ token-ржПрж░ ржнрзЗрждрж░рзЗ ржПржЗ рждржерзНржп ржерж╛ржХрзЗ
// JWT_ACCESS_SECRET ржжрж┐ржпрж╝рзЗ sign рж╣ржпрж╝ тАФ ржПржЗ secret ржЫрж╛ржбрж╝рж╛ ржХрзЗржЙ ржЬрж╛рж▓ token ржмрж╛ржирж╛рждрзЗ ржкрж╛рж░ржмрзЗ ржирж╛
//
// ЁЯПа ржЙржжрж╛рж╣рж░ржг:
// jwt.sign() = ржкрж╛рж╕ржкрзЛрж░рзНржЯ ржЕржлрж┐рж╕рзЗ ржкрж╛рж╕ржкрзЛрж░рзНржЯ ржмрж╛ржирж╛ржирзЛ
// payload = рждрзЛржорж╛рж░ рждржерзНржп (ржирж╛ржо, ржарж┐ржХрж╛ржирж╛)
// secret = рж╕рж░ржХрж╛рж░рж┐ рж╕рж┐рж▓ (ржЬрж╛рж▓ ржХрж░рж╛ ржкрзНрж░рж╛ржпрж╝ ржЕрж╕ржорзНржнржм)
// expiresIn = ржорзЗржпрж╝рж╛ржж (рззрзл ржорж┐ржирж┐ржЯ)

const generateRefreshToken = () => {
  return crypto.randomBytes(64).toString("hex");
};
// Refresh Token = рзмрзк byte random data тЖТ hex string
// ржПржЯрж╛ JWT ржирж╛! ржПржЯрж╛ рж╢рзБржзрзБржЗ ржПржХржЯрж╛ random string
// ржЙржжрж╛рж╣рж░ржг result: "a3b8f1c9d2e4..." (128 characters)
//
// ЁЯдФ ржХрзЗржи JWT ржирж╛?
// Refresh token-ржП data encode ржХрж░рж╛рж░ ржжрж░ржХрж╛рж░ ржирзЗржЗ
// ржПржХржЯрж╛ unique, unguessable string рж╣рж▓рзЗржЗ ржпржерзЗрж╖рзНржЯ

const verifyAccessToken = (token) => {
  return jwt.verify(token, process.env.JWT_ACCESS_SECRET);
};
// Access Token рж╕ржарж┐ржХ ржХрж┐ржирж╛ ржпрж╛ржЪрж╛ржЗ ржХрж░рзЗ
// рж╕ржарж┐ржХ рж╣рж▓рзЗ: decoded payload ржлрзЗрж░ржд ржЖрж╕рзЗ { userId, role, tokenVersion }
// ржнрзБрж▓/ржорзЗржпрж╝рж╛ржж рж╢рзЗрж╖ рж╣рж▓рзЗ: error throw ржХрж░рзЗ
//
// ЁЯПа ржЙржжрж╛рж╣рж░ржг: ржкрж╛рж╕ржкрзЛрж░рзНржЯ ржЪрзЗржХ тАФ рж╕рж┐рж▓ ржЖрж╕рж▓ ржХрж┐ржирж╛ ржУ ржорзЗржпрж╝рж╛ржж ржЖржЫрзЗ ржХрж┐ржирж╛

const hashRefreshToken = (token) => {
  return crypto.createHash("sha256").update(token).digest("hex");
};
// Refresh token-ржХрзЗ SHA-256 ржжрж┐ржпрж╝рзЗ hash ржХрж░рзЗ
// Database-ржП raw refresh token рж░рж╛ржЦрж╛ рж╣ржпрж╝ ржирж╛, hash рж░рж╛ржЦрж╛ рж╣ржпрж╝
// ЁЯЫбя╕П ржХрзЗржи? Database рж╣рзНржпрж╛ржХ рж╣рж▓рзЗржУ ржЖрж╕рж▓ token ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржмрзЗ ржирж╛

module.exports = {
  generateAccessToken,
  generateRefreshToken,
  verifyAccessToken,
  hashRefreshToken,
};
```

### ЁЯОЯя╕П Access Token vs Refresh Token тАФ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржкрж╛рж░рзНржержХрзНржп

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ                     тФВ   Access Token       тФВ   Refresh Token      тФВ
тФЬтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФд
тФВ ржХрзА?                 тФВ JWT token            тФВ Random hex string    тФВ
тФВ ржорзЗржпрж╝рж╛ржж                тФВ рззрзл ржорж┐ржирж┐ржЯ (ржЫрзЛржЯ)         тФВ рзн ржжрж┐ржи (ржмржбрж╝)            тФВ
тФВ ржХрзЛржерж╛ржпрж╝ ржерж╛ржХрзЗ?          тФВ Client memory/header тФВ httpOnly Cookie       тФВ
тФВ ржХрж╛ржЬ                 тФВ API request ржХрж░рждрзЗ     тФВ ржирждрзБржи access token ржирж┐рждрзЗ  тФВ
тФВ ржЪрзБрж░рж┐ рж╣рж▓рзЗ?             тФВ рззрзл ржорж┐ржирж┐ржЯ ржкрж░рзЗ ржЕржХрзЗржЬрзЛ     тФВ Rotation-ржП ржзрж░рж╛ ржкржбрж╝рзЗ    тФВ
тФВ Database-ржП ржЖржЫрзЗ?    тФВ ржирж╛                    тФВ рж╣рзНржпрж╛ржБ (hash рж╣рж┐рж╕рзЗржмрзЗ)       тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ┤тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

### ЁЯФД Token Rotation ржХрзА?

ржкрзНрж░рждрж┐ржмрж╛рж░ refresh token ржмрзНржпржмрж╣рж╛рж░ рж╣рж▓рзЗ:

1. ржкрзБрж░ржирзЛ refresh token ржорзБржЫрзЗ ржжрзЗржУржпрж╝рж╛ рж╣ржпрж╝
2. ржирждрзБржи refresh token рждрзИрж░рж┐ рж╣ржпрж╝
3. ржирждрзБржи access token-ржУ рждрзИрж░рж┐ рж╣ржпрж╝

**ржХрзЗржи?** ржХрзЗржЙ ржкрзБрж░ржирзЛ token ржЪрзБрж░рж┐ ржХрж░рж▓рзЗ, рж╕рзЗржЯрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ ржЧрзЗрж▓рзЗ ржжрзЗржЦржмрзЗ тАФ "ржПржЗ token рждрзЛ ржирзЗржЗ!"

---

# ржЕржзрзНржпрж╛ржпрж╝ рзн: Middlewares

## ЁЯдФ Middleware ржХрзА?

Middleware рж╣рж▓рзЛ **ржорж╛ржЭржЦрж╛ржирзЗрж░ рж╕ржлржЯржУржпрж╝рзНржпрж╛рж░** тАФ request ржЖрж╕рж╛ ржерзЗржХрзЗ response ржпрж╛ржУржпрж╝рж╛рж░ ржоржзрзНржпрзЗ ржпрзЗ ржХрж╛ржЬржЧрзБрж▓рзЛ рж╣ржпрж╝ред

```
[Request] тЖТ [Middleware 1] тЖТ [Middleware 2] тЖТ [Route Handler] тЖТ [Response]
```

**ЁЯПа ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг**: ржЕржлрж┐рж╕рзЗ ржврзЛржХрж╛рж░ ржЖржЧрзЗ рзйржЯрж╛ ржЪрзЗржХржкржпрж╝рзЗржирзНржЯ:

1. ржЧрзЗржЯрзЗ ID ржЪрзЗржХ (auth middleware)
2. ржмрзНржпрж╛ржЧ рж╕рзНржХрзНржпрж╛ржи (security)
3. рж░рзЗржЬрж┐рж╕рзНржЯрж╛рж░рзЗ ржирж╛ржо рж▓рзЗржЦрж╛ (logging)

## ЁЯУД `auth.middleware.js` тАФ Token ржпрж╛ржЪрж╛ржЗ

```javascript
const { prisma } = require("../config/prisma");
const { verifyAccessToken } = require("../utils/token");

const authMiddleware = async (req, res, next) => {
  // req = request (ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАрж░ ржЕржирзБрж░рзЛржз)
  // res = response (рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржЙрждрзНрждрж░)
  // next = ржкрж░ржмрж░рзНрждрзА middleware/route-ржП ржпрж╛ржУ

  try {
    const authHeader = req.headers.authorization;
    // Request-ржПрж░ header ржерзЗржХрзЗ "Authorization" ржкржбрж╝рзЛ
    // ржПржЯрж╛ ржПржоржи ржжрзЗржЦрж╛ржпрж╝: "Bearer eyJhbGciOiJIUzI1NiIs..."

    if (!authHeader || !authHeader.startsWith("Bearer ")) {
      return res.status(401).json({ message: "Unauthorized" });
    }
    // Authorization header ржирж╛ ржерж╛ржХрж▓рзЗ ржмрж╛ "Bearer " ржжрж┐ржпрж╝рзЗ рж╢рзБрж░рзБ ржирж╛ рж╣рж▓рзЗ тЖТ ржмрзНрж▓ржХ!
    // 401 = Unauthorized (рждрзЛржорж╛рж░ ржЕржирзБржорждрж┐ ржирзЗржЗ)

    const token = authHeader.split(" ")[1];
    // "Bearer eyJhbG..." тЖТ split ржХрж░рзЗ тЖТ ["Bearer", "eyJhbG..."] тЖТ [1] ржирж┐рж▓рзЗ token ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝

    const decoded = verifyAccessToken(token);
    // Token verify ржХрж░рзЛ тАФ рж╕ржарж┐ржХ рж╣рж▓рзЗ { userId, role, tokenVersion } ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржмрзЗ

    const user = await prisma.user.findUnique({
      where: { id: decoded.userId },
    });
    // Token-ржП ржерж╛ржХрж╛ userId ржжрж┐ржпрж╝рзЗ database ржерзЗржХрзЗ user ржЦрзБржБржЬрзЛ

    if (!user) {
      return res.status(401).json({ message: "Unauthorized" });
    }
    // User ржирж╛ ржкрж╛ржУржпрж╝рж╛ ржЧрзЗрж▓рзЗ тЖТ ржмрзНрж▓ржХ!
    // (рж╣ржпрж╝рждрзЛ user delete рж╣ржпрж╝рзЗ ржЧрзЗржЫрзЗ)

    // тЪая╕П Token version check (ржЦрзБржмржЗ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг!)
    if (decoded.tokenVersion !== user.tokenVersion) {
      return res.status(401).json({ message: "Token expired" });
    }
    // Token-ржП ржерж╛ржХрж╛ version ржЖрж░ database-ржПрж░ version ржирж╛ ржорж┐рж▓рж▓рзЗ тЖТ ржмрзНрж▓ржХ!
    //
    // ЁЯПа ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ?
    // рзз. User login ржХрж░рж▓рзЗ tokenVersion = 0, token-ржПржУ version = 0
    // рзи. Admin "force logout" ржХрж░рж▓рзЗ database-ржП tokenVersion = 1 рж╣ржпрж╝
    // рзй. ржкрзБрж░ржирзЛ token-ржП version = 0 тАФ mismatch! тЖТ token ржЕржХрзЗржЬрзЛ
    // рзк. User-ржХрзЗ ржЖржмрж╛рж░ login ржХрж░рждрзЗ рж╣ржмрзЗ (ржирждрзБржи token-ржП version = 1)
    //
    // ржПржЯрж╛ "рж╕ржм ржбрж┐ржнрж╛ржЗрж╕ ржерзЗржХрзЗ logout" ржХрж░рж╛рж░ рж╕ржмржЪрзЗржпрж╝рзЗ рж╕рж╣ржЬ ржЙржкрж╛ржпрж╝!

    req.user = user;
    // request-ржП user рждржерзНржп ржпрзЛржЧ ржХрж░рзЛ
    // ржкрж░рзЗрж░ route handler-ржП req.user ржжрж┐ржпрж╝рзЗ user-ржПрж░ рждржерзНржп ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржмрзЗ

    next();
    // рж╕ржм ржарж┐ржХ ржЖржЫрзЗ тАФ ржкрж░ржмрж░рзНрждрзА ржзрж╛ржкрзЗ ржпрж╛ржУ тЬЕ
  } catch {
    return res.status(401).json({ message: "Unauthorized" });
  }
  // ржпрзЗржХрзЛржирзЛ error рж╣рж▓рзЗ (invalid token, expired token) тЖТ ржмрзНрж▓ржХ!
};

module.exports = authMiddleware;
```

## ЁЯУД `error.middleware.js` тАФ Global Error Handler

```javascript
// eslint-disable-next-line no-unused-vars
const errorMiddleware = (err, req, res, next) => {
  // Express-ржП рзкржЯрж╛ parameter ржерж╛ржХрж▓рзЗ рж╕рзЗржЯрж╛ error middleware рж╣рж┐рж╕рзЗржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ
  // err = error object (ржХрзА ржнрзБрж▓ рж╣ржпрж╝рзЗржЫрзЗ)
  // next ржмрзНржпржмрж╣рж╛рж░ рж╣ржЪрзНржЫрзЗ ржирж╛, ржХрж┐ржирзНрждрзБ Express-ржПрж░ ржЬржирзНржп рзкржЯрж╛ parameter ржжрж░ржХрж╛рж░

  console.error(err);
  // Error-ржЯрж╛ console-ржП ржжрзЗржЦрж╛ржУ (debugging-ржПрж░ ржЬржирзНржп)

  res.status(500).json({
    message: "Internal Server Error",
  });
  // Client-ржХрзЗ ржмрж▓рзЛ "рж╕рж╛рж░рзНржнрж╛рж░рзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗ"
  // 500 = Internal Server Error
  // ЁЯЫбя╕П ржирж┐рж░рж╛ржкрждрзНрждрж╛: Client-ржХрзЗ ржХржЦржирзЛ ржЖрж╕рж▓ error message ржжрзЗржЦрж╛ржмрзЗ ржирж╛!
  // ржХрж╛рж░ржг attacker error message ржерзЗржХрзЗ рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ ржжрзБрж░рзНржмрж▓рждрж╛ ржмрзБржЭрждрзЗ ржкрж╛рж░рзЗ
};

module.exports = errorMiddleware;
```

## ЁЯУД `rateLimiter.middleware.js` тАФ Brute Force Protection

```javascript
const rateLimit = require("express-rate-limit");

const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000,
  // рззрзл ржорж┐ржирж┐ржЯрзЗрж░ window
  // 15 ├Ч 60 ├Ч 1000 = 900,000 milliseconds = рззрзл ржорж┐ржирж┐ржЯ

  max: 10,
  // ржПржЗ рззрзл ржорж┐ржирж┐ржЯрзЗ рж╕рж░рзНржмрзЛржЪрзНржЪ рззрзжржЯрж╛ request ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗ

  message: "Too many login attempts. Try again later.",
  // limit ржкрж╛рж░ рж╣рж▓рзЗ ржПржЗ message ржжрзЗржЦрж╛ржмрзЗ
});
// ЁЯПа ржЙржжрж╛рж╣рж░ржг: ATM-ржП рзй ржмрж╛рж░ ржнрзБрж▓ PIN ржжрж┐рж▓рзЗ card block рж╣ржпрж╝рзЗ ржпрж╛ржпрж╝
// ржПржЦрж╛ржирзЗ рззрзл ржорж┐ржирж┐ржЯрзЗ рззрзж ржмрж╛рж░рзЗрж░ ржмрзЗрж╢рж┐ login ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рж▓рзЗ ржмрзНрж▓ржХ
//
// ЁЯЫбя╕П ржХрзЗржи ржжрж░ржХрж╛рж░?
// рж╣рзНржпрж╛ржХрж╛рж░ "brute force attack" ржХрж░рзЗ тАФ рж╣рж╛ржЬрж╛рж░ рж╣рж╛ржЬрж╛рж░ password ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзЗ
// rate limiter ржПржЯрж╛ ржЖржЯржХрж╛ржпрж╝

module.exports = { loginLimiter };
```

---

# ржЕржзрзНржпрж╛ржпрж╝ рзо: Auth Module тАФ ржорзВрж▓ ржмрзНржпржмрж╕рж╛ржпрж╝рж┐ржХ рж▓ржЬрж┐ржХ

ржПржЯрж╛ржЗ ржкрзНрж░ржЬрзЗржХрзНржЯрзЗрж░ **рж╣рзГржжржкрж┐ржгрзНржб** тАФ рж╕ржм authentication-ржПрж░ ржХрж╛ржЬ ржПржЦрж╛ржирзЗ рж╣ржпрж╝ред

## ЁЯУД `auth.routes.js` тАФ URL ржкрже ржирж┐рж░рзНржзрж╛рж░ржг

```javascript
const express = require("express");
const { signup, login, refresh, logout, getMe } = require("./auth.controller");
const authMiddleware = require("../../middlewares/auth.middleware");
const { loginLimiter } = require("../../middlewares/rateLimiter.middleware");

const router = express.Router();
// Express Router тАФ route ржЧрзБрж▓рзЛ ржЧрзНрж░рзБржк ржХрж░рждрзЗ ржмрзНржпржмрж╣рж╛рж░ рж╣ржпрж╝

router.post("/signup", signup);
// POST /api/v1/auth/signup тЖТ ржирждрзБржи ржЗржЙржЬрж╛рж░ рждрзИрж░рж┐

router.post("/login", loginLimiter, login);
// POST /api/v1/auth/login тЖТ рж▓ржЧржЗржи (rate limit рж╕рж╣)

router.get("/me", authMiddleware, getMe);
// GET /api/v1/auth/me тЖТ ржирж┐ржЬрзЗрж░ рждржерзНржп (token ржжрж░ржХрж╛рж░)

router.post("/refresh", refresh);
// POST /api/v1/auth/refresh тЖТ ржирждрзБржи access token

router.post("/logout", logout);
// POST /api/v1/auth/logout тЖТ рж▓ржЧржЖржЙржЯ
```

## ЁЯУД `auth.repository.js` тАФ Database Query

```javascript
const findUserByEmail = (email) => {
  return prisma.user.findUnique({ where: { email } });
};
// SQL: SELECT * FROM User WHERE email = '...' LIMIT 1

const createUser = (data) => {
  return prisma.user.create({ data });
};
// SQL: INSERT INTO User (...) VALUES (...)

const createRefreshToken = (data) => {
  return prisma.refreshToken.create({ data });
};
// SQL: INSERT INTO RefreshToken (...) VALUES (...)
```

## ЁЯУД `auth.service.js` тАФ ржмрзНржпржмрж╕рж╛ржпрж╝рж┐ржХ рж▓ржЬрж┐ржХ (ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд)

### ЁЯФ╡ Signup Flow

```
User тЖТ POST /signup { email, password }
  тЖТ ржЗржорзЗржЗрж▓ ржЖржЧрзЗ ржЖржЫрзЗ? тЖТ рж╣рзНржпрж╛ржБ тЖТ Error: "User already exists"
                      тЖТ ржирж╛ тЖТ password hash тЖТ DB-рждрзЗ save тЖТ 201 Created
```

```javascript
const signupService = async (email, password) => {
  const existingUser = await findUserByEmail(email);
  if (existingUser) throw new Error("User already exists");

  const passwordHash = await hashPassword(password);
  // mypass123 тЖТ $2a$12$... (ржПржХржорзБржЦрзА, ржлрзЗрж░ржд ржЖрж╕ржмрзЗ ржирж╛)

  const user = await createUser({ id: uuidv4(), email, passwordHash });
  return user;
};
```

### ЁЯЯв Login Flow

```
User тЖТ POST /login { email, password }
  тЖТ email ржжрж┐ржпрж╝рзЗ user ржЦрзЛржБржЬрзЛ тЖТ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржЪрзЗржХ
  тЖТ Access Token (JWT, рззрзл ржорж┐ржирж┐ржЯ) рждрзИрж░рж┐
  тЖТ Refresh Token (random hex) рждрзИрж░рж┐ тЖТ hash ржХрж░рзЗ DB-рждрзЗ рж░рж╛ржЦрзЛ
  тЖТ Access Token тЖТ response body | Refresh Token тЖТ httpOnly cookie
```

```javascript
const loginService = async (email, password) => {
  const user = await findUserByEmail(email);
  if (!user) throw new Error("Invalid credentials");
  // ЁЯЫбя╕П "Wrong password" ржирж╛ ржмрж▓рзЗ "Invalid credentials" тАФ рж╣рзНржпрж╛ржХрж╛рж░ ржЬрж╛ржирзБржХ ржирж╛!

  const isMatch = await comparePassword(password, user.passwordHash);
  if (!isMatch) throw new Error("Invalid credentials");

  const accessToken = generateAccessToken({
    userId: user.id,
    role: user.role,
    tokenVersion: user.tokenVersion,
  });

  const refreshToken = generateRefreshToken();
  const refreshTokenHash = hashRefreshToken(refreshToken);

  await createRefreshToken({
    id: uuidv4(),
    userId: user.id,
    tokenHash: refreshTokenHash,
    expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // рзн ржжрж┐ржи
  });

  return { user, accessToken, refreshToken };
};
```

### ЁЯЯб Refresh Flow (Token Rotation)

```
Client тЖТ POST /refresh (cookie-рждрзЗ ржкрзБрж░ржирзЛ refreshToken)
  тЖТ hash ржХрж░рзЛ тЖТ DB-рждрзЗ ржЦрзЛржБржЬрзЛ тЖТ ржорзЗржпрж╝рж╛ржж ржЪрзЗржХ
  тЖТ ржкрзБрж░ржирзЛ token DELETE тЭМ тЖТ ржирждрзБржи token рждрзИрж░рж┐ INSERT тЬЕ
  тЖТ ржирждрзБржи access + refresh token return
```

```javascript
const refreshService = async (refreshToken) => {
  const hashedToken = hashRefreshToken(refreshToken);

  const existingToken = await prisma.refreshToken.findFirst({
    where: { tokenHash: hashedToken, isRevoked: false },
  });
  if (!existingToken) throw new Error("Invalid refresh token");
  if (existingToken.expiresAt < new Date()) throw new Error("Expired");

  // ЁЯФД Rotation: ржкрзБрж░ржирзЛ ржорзБржЫрзЛ тЖТ ржирждрзБржи рждрзИрж░рж┐ ржХрж░рзЛ
  await prisma.refreshToken.delete({ where: { id: existingToken.id } });

  const newRefreshToken = generateRefreshToken();
  await prisma.refreshToken.create({
    data: {
      userId: existingToken.userId,
      tokenHash: hashRefreshToken(newRefreshToken),
      expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
    },
  });

  const newAccessToken = generateAccessToken({
    userId: user.id,
    role: user.role,
    tokenVersion: user.tokenVersion,
  });

  return { accessToken: newAccessToken, refreshToken: newRefreshToken };
};
```

### ЁЯФ┤ Logout Flow

```javascript
const logoutService = async (refreshToken) => {
  const hashedToken = hashRefreshToken(refreshToken);
  await prisma.refreshToken.updateMany({
    where: { tokenHash: hashedToken },
    data: { isRevoked: true }, // token "ржмрж╛рждрж┐рж▓" ржЪрж┐рж╣рзНржирж┐ржд
  });
};
// ЁЯПа ржЙржжрж╛рж╣рж░ржг: ржнрж┐ржЬрж┐ржЯрж░ ржкрж╛рж╕ ржлрж┐рж░рж┐ржпрж╝рзЗ ржжрзЗржУржпрж╝рж╛ тАФ рж╕рзЗржЗ ржкрж╛рж╕ ржЖрж░ ржХрж╛ржЬ ржХрж░ржмрзЗ ржирж╛
```

## ЁЯУД `auth.controller.js` тАФ Request-Response

```javascript
// signup тЖТ req.body ржерзЗржХрзЗ { email, password } тЖТ signupService тЖТ 201 Created
// login тЖТ loginService тЖТ refreshToken cookie-рждрзЗ, accessToken body-рждрзЗ
// getMe тЖТ authMiddleware ржкрж╛рж╕ рж╣рж▓рзЗ тЖТ req.user-ржПрж░ рждржерзНржп return
// refresh тЖТ cookie ржерзЗржХрзЗ token тЖТ refreshService тЖТ ржирждрзБржи tokens
// logout тЖТ logoutService тЖТ cookie clear тЖТ 200 "Logged out"
```

### Cookie Flags (ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг):

```javascript
res.cookie("refreshToken", refreshToken, {
  httpOnly: true, // JS ржерзЗржХрзЗ ржкржбрж╝рж╛ ржпрж╛ржмрзЗ ржирж╛ тЖТ XSS protection
  secure: true, // рж╢рзБржзрзБ HTTPS тЖТ ржорж╛ржЭржкржерзЗ ржЪрзБрж░рж┐ рж░рзЛржз
  sameSite: "strict", // ржЕржирзНржп site ржерзЗржХрзЗ ржкрж╛ржарж╛ржирзЛ ржпрж╛ржмрзЗ ржирж╛ тЖТ CSRF рж░рзЛржз
});
```

---

# ржЕржзрзНржпрж╛ржпрж╝ рзп: Security Best Practices

| #   | ржмрж┐рж╖ржпрж╝                | ржХрзА ржХрж░рзЗ               | ржХрзЛржерж╛ржпрж╝                      |
| --- | -------------------- | -------------------- | --------------------------- |
| рзз   | **Password Hashing** | bcrypt 12 rounds     | `hash.js`                   |
| рзи   | **JWT Short Expiry** | рззрзл ржорж┐ржирж┐ржЯ ржорзЗржпрж╝рж╛ржж      | `token.js`                  |
| рзй   | **httpOnly Cookie**  | JS ржерзЗржХрзЗ ржЪрзБрж░рж┐ рж░рзЛржз     | `auth.controller.js`        |
| рзк   | **Token Rotation**   | ржмрзНржпржмрж╣рж╛рж░рзЗ ржкрзБрж░ржирзЛ ржзрзНржмржВрж╕ | `auth.service.js`           |
| рзл   | **Token Version**    | Force logout         | `auth.middleware.js`        |
| рзм   | **Helmet**           | Security headers     | `app.js`                    |
| рзн   | **Rate Limiting**    | Brute force рж░рзЛржз      | `rateLimiter.middleware.js` |
| рзо   | **CORS**             | ржЕржирзБржорзЛржжрж┐ржд domain      | `app.js`                    |
| рзп   | **JSON Limit**       | 10KB max body        | `app.js`                    |
| рззрзж  | **Token Hash in DB** | SHA-256 hash         | `auth.service.js`           |

### тЪая╕П Token Version ржХрж╛ржЬрзЗрж░ ржкржжрзНржзрждрж┐

```
рзз. Login тЖТ tokenVersion = 0, token-ржПржУ 0
рзи. Admin force logout тЖТ DB-рждрзЗ tokenVersion = 1
рзй. ржкрзБрж░ржирзЛ token (v=0) тЖТ middleware mismatch тЖТ BLOCKED!
рзк. ржЖржмрж╛рж░ login тЖТ ржирждрзБржи token (v=1) тЬЕ
```

---

# ржЕржзрзНржпрж╛ржпрж╝ рззрзж: Docker ржУ Containerization

## ЁЯУД `Dockerfile` тАФ Multi-stage Build

### Stage 1: Builder

```dockerfile
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install              # ржЖржЧрзЗ dependency тЖТ Docker cache!
COPY . .
ARG DATABASE_URL="mysql://root:password@db:3306/authdb"
ENV DATABASE_URL=$DATABASE_URL
RUN npx prisma generate      # Prisma Client рждрзИрж░рж┐
```

### Stage 2: Production

```dockerfile
FROM node:20-alpine          # Fresh image тАФ ржЖржмрж░рзНржЬржирж╛ ржорзБржХрзНржд!
WORKDIR /app
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/src ./src
COPY --from=builder /app/prisma ./prisma
COPY --from=builder /app/package*.json ./
COPY --from=builder /app/prisma.config.ts ./prisma.config.ts

ENV NODE_ENV=production
EXPOSE 5100

HEALTHCHECK --interval=30s --timeout=5s --start-period=5s --retries=3 \
  CMD wget -qO- http://localhost:5100/health || exit 1
# ржкрзНрж░рждрж┐ рзйрзж рж╕рзЗржХрзЗржирзНржбрзЗ /health ржЪрзЗржХ

CMD ["sh", "-c", "npx prisma migrate deploy --config=./prisma.config.ts && node src/server.js"]
# рзз. Migration тЖТ рзи. рж╕рж╛рж░рзНржнрж╛рж░ ржЪрж╛рж▓рзБ
```

## ЁЯУД `docker-compose.yml`

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ              Docker Network (backend)      тФВ
тФВ  тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР      тФВ
тФВ  тФВ   auth_db    тФВтЧДтФАтФАтФАтФВ   auth_app   тФВ      тФВ
тФВ  тФВ  (MySQL 8)   тФВ    тФВ  (Node.js)   тФВ      тФВ
тФВ  тФВ  Port: 3306  тФВ    тФВ  Port: 5100  тФВтЧДтФАтФА Host:5100
тФВ  тФФтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФАтФШ    тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ      тФВ
тФВ    mysql_data (persistent)                 тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

- `db` service: MySQL 8, healthcheck, persistent volume
- `app` service: Dockerfile ржерзЗржХрзЗ build, `.env` рж▓рзЛржб, db ready рж╣рж▓рзЗржЗ ржЪрж╛рж▓рзБ

---

# ржЕржзрзНржпрж╛ржпрж╝ рззрзз: CI/CD Pipeline тАФ GitHub Actions

## ЁЯУД `ci.yml` тАФ рзкржЯрж┐ Job ржХрзНрж░ржорж╛ржирзБрж╕рж╛рж░рзЗ

```
Code Push тЖТ Lint тЬЕ тЖТ Test тЬЕ тЖТ Security тЬЕ тЖТ Docker Build тЬЕ
             тЭМ         тЭМ         тЭМ             тЭМ
           STOP!      STOP!      STOP!         STOP!
```

| Job              | ржХрж╛ржЬ                            | needs    |
| ---------------- | ------------------------------ | -------- |
| **lint**         | ESLint ржХрзЛржб ржЪрзЗржХ                 | тАФ        |
| **test**         | Jest ржЯрзЗрж╕рзНржЯ                     | lint     |
| **security**     | npm audit + Trivy scan         | test     |
| **docker-build** | Image build + Trivy image scan | security |

## ЁЯУД `deploy.yml` тАФ CI рж╕ржлрж▓ рж╣рж▓рзЗ Deploy

```
develop push тЖТ CI рж╕ржлрж▓ тЖТ Staging Deploy (auto)
main push    тЖТ CI рж╕ржлрж▓ тЖТ Production Deploy (manual approval)
```

- **Staging**: image тЖТ "staging" tag тЖТ GHCR push
- **Production**: image тЖТ "latest" + commit SHA tag тЖТ GHCR push
- SHA tag = rollback-ржП ржХрж╛ржЬрзЗ ржЖрж╕рзЗ

---

# ржЕржзрзНржпрж╛ржпрж╝ рззрзи: ESLint ржУ Code Quality

## ЁЯдФ ESLint ржХрзА?

ESLint рж╣рж▓рзЛ JavaScript-ржПрж░ ржЬржирзНржп **ржХрзЛржб ржкрж░рзАржХрзНрж╖ржХ** тАФ ржХрзЛржбрзЗ ржнрзБрж▓, ржЕржмрзНржпржмрж╣рзГржд variable, рж╕рзНржЯрж╛ржЗрж▓ рж╕ржорж╕рзНржпрж╛ ржЦрзБржБржЬрзЗ ржмрзЗрж░ ржХрж░рзЗред

**ЁЯПа ржЙржжрж╛рж╣рж░ржг**: ржкрж░рзАржХрзНрж╖рж╛рж░ ржЦрж╛рждрж╛ржпрж╝ рж╢рж┐ржХрзНрж╖ржХ рж▓рж╛рж▓ ржХрж╛рж▓рж┐ ржжрж┐ржпрж╝рзЗ ржнрзБрж▓ ржжрзЗржЦрж┐ржпрж╝рзЗ ржжрзЗржи тАФ ESLint рж╕рзЗржЗ рж╢рж┐ржХрзНрж╖ржХ!

## ЁЯУД `eslint.config.mjs` тАФ рж▓рж╛ржЗржи-ржмрж╛ржЗ-рж▓рж╛ржЗржи

```javascript
import js from "@eslint/js";
// ESLint-ржПрж░ recommended JavaScript rules ржЗржорзНржкрзЛрж░рзНржЯ

import globals from "globals";
// Global variables-ржПрж░ рждрж╛рж▓рж┐ржХрж╛ (console, process, require ржЗрждрзНржпрж╛ржжрж┐)

import { defineConfig } from "eslint/config";

export default defineConfig([
  {
    files: ["**/*.{js,mjs,cjs}"],
    // рж╕ржм .js, .mjs, .cjs ржлрж╛ржЗрж▓рзЗ ESLint ржЪрж▓ржмрзЗ

    plugins: { js },
    // JavaScript plugin ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ

    extends: ["js/recommended"],
    // recommended rules ржЪрж╛рж▓рзБ ржХрж░рзЛ (ржнрж╛рж▓рзЛ ржЪрж░рзНржЪрж╛ржЧрзБрж▓рзЛ)
    // ржпрзЗржоржи: ржЕржмрзНржпржмрж╣рзГржд variable ржзрж░ржмрзЗ, == ржПрж░ ржмржжрж▓рзЗ === suggest ржХрж░ржмрзЗ

    languageOptions: {
      globals: { ...globals.node, ...globals.jest },
      // Node.js globals: process, require, module, __dirname ржЗрждрзНржпрж╛ржжрж┐
      // Jest globals: describe, it, expect ржЗрждрзНржпрж╛ржжрж┐
      // ржПржЧрзБрж▓рзЛ ржирж╛ ржжрж┐рж▓рзЗ ESLint ржнрж╛ржмржмрзЗ ржПржЧрзБрж▓рзЛ undefined variable
    },
  },
]);
```

### ESLint ржХрзАржнрж╛ржмрзЗ ржЪрж╛рж▓рж╛ржмрзЗ?

```bash
npm run lint          # ржХрзЛржб ржЪрзЗржХ (рж╕ржорж╕рзНржпрж╛ ржжрзЗржЦрж╛ржмрзЗ)
```

---

# ржЕржзрзНржпрж╛ржпрж╝ рззрзй: Testing тАФ Jest

## ЁЯдФ Jest ржХрзА?

Jest рж╣рж▓рзЛ JavaScript-ржПрж░ ржЬржирзНржп **ржЯрзЗрж╕рзНржЯрж┐ржВ ржлрзНрж░рзЗржоржУржпрж╝рж╛рж░рзНржХ**ред ржХрзЛржб ржарж┐ржХржорждрзЛ ржХрж╛ржЬ ржХрж░ржЫрзЗ ржХрж┐ржирж╛ automatically ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзЗред

**ЁЯПа ржЙржжрж╛рж╣рж░ржг**: ржирждрзБржи ржЧрж╛ржбрж╝рж┐ рждрзИрж░рж┐рж░ ржкрж░рзЗ ржмрзНрж░рзЗржХ, ржЗржЮрзНржЬрж┐ржи, рж▓рж╛ржЗржЯ ржЪрзЗржХ ржХрж░рж╛ рж╣ржпрж╝ тАФ Jest рж╕рзЗржЗ inspector!

## ЁЯУД `src/tests/health.test.js` тАФ рж▓рж╛ржЗржи-ржмрж╛ржЗ-рж▓рж╛ржЗржи

```javascript
describe("Health check", () => {
  // describe() = ржПржХржЯрж╛ ржЯрзЗрж╕рзНржЯ ржЧрзНрж░рзБржк (category)
  // "Health check" = ржПржЗ ржЧрзНрж░рзБржкрзЗрж░ ржирж╛ржо

  it("should return true", () => {
    // it() = ржПржХржЯрж╛ individual ржЯрзЗрж╕рзНржЯ ржХрзЗрж╕
    // "should return true" = ржПржЗ ржЯрзЗрж╕рзНржЯржЯрж╛ ржХрзА ржкрж░рзАржХрзНрж╖рж╛ ржХрж░ржЫрзЗ

    expect(true).toBe(true);
    // expect() = "ржЖржорж┐ ржЖрж╢рж╛ ржХрж░рж┐..."
    // .toBe() = "...ржПржЯрж╛ рж╣ржмрзЗ..."
    // expect(true).toBe(true) = "ржЖржорж┐ ржЖрж╢рж╛ ржХрж░рж┐ true рж╣ржмрзЗ true" тЖТ ржкрж╛рж╕! тЬЕ
  });
});
```

> тЪая╕П **ржирзЛржЯ**: ржПржЯрж╛ ржПржХржЯрж╛ placeholder test тАФ рж╢рзБржзрзБ CI pipeline-ржП test step ржпрж╛рждрзЗ fail ржирж╛ ржХрж░рзЗред ржЖрж╕рж▓ ржкрзНрж░ржЬрзЗржХрзНржЯрзЗ ржЖрж░рзЛ ржЕржирзЗржХ tests рж▓рзЗржЦрж╛ ржЙржЪрж┐ржд, ржпрзЗржоржи:
>
> - Signup API test (ржирждрзБржи ржЗржЙржЬрж╛рж░ рждрзИрж░рж┐ рж╣ржпрж╝ ржХрж┐ржирж╛)
> - Login API test (рж╕ржарж┐ржХ/ржнрзБрж▓ password-ржП ржХрзА рж╣ржпрж╝)
> - Token refresh test

### Jest ржХрзАржнрж╛ржмрзЗ ржЪрж╛рж▓рж╛ржмрзЗ?

```bash
npm test              # рж╕ржм test ржЪрж╛рж▓рж╛ржУ
```

---

# ржЕржзрзНржпрж╛ржпрж╝ рззрзк: рж╕ржорзНржкрзВрж░рзНржг API Reference

## ЁЯУЛ рж╕ржм Endpoints ржПржХ ржиржЬрж░рзЗ

| Method | URL                    | Auth ржжрж░ржХрж╛рж░?    | ржХрж╛ржЬ               |
| ------ | ---------------------- | -------------- | ----------------- |
| `POST` | `/api/v1/auth/signup`  | тЭМ ржирж╛          | ржирждрзБржи ржЗржЙржЬрж╛рж░ рждрзИрж░рж┐   |
| `POST` | `/api/v1/auth/login`   | тЭМ ржирж╛          | рж▓ржЧржЗржи              |
| `GET`  | `/api/v1/auth/me`      | тЬЕ рж╣рзНржпрж╛ржБ       | ржирж┐ржЬрзЗрж░ рждржерзНржп        |
| `POST` | `/api/v1/auth/refresh` | тЭМ ржирж╛ (cookie) | ржирждрзБржи access token |
| `POST` | `/api/v1/auth/logout`  | тЭМ ржирж╛ (cookie) | рж▓ржЧржЖржЙржЯ             |
| `GET`  | `/health`              | тЭМ ржирж╛          | рж╕рж╛рж░рзНржнрж╛рж░ status    |

---

### 1я╕ПтГг POST `/api/v1/auth/signup` тАФ рж░рзЗржЬрж┐рж╕рзНржЯрзНрж░рзЗрж╢ржи

**Request:**

```json
{
  "email": "reza@gmail.com",
  "password": "MyStr0ngP@ss"
}
```

**рж╕ржлрж▓ Response (201):**

```json
{
  "message": "User created successfully",
  "user": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "reza@gmail.com"
  }
}
```

**Error Response (400):** `{ "message": "User already exists" }`

---

### 2я╕ПтГг POST `/api/v1/auth/login` тАФ рж▓ржЧржЗржи

**Request:**

```json
{
  "email": "reza@gmail.com",
  "password": "MyStr0ngP@ss"
}
```

**рж╕ржлрж▓ Response (200):**

```json
{ "accessToken": "eyJhbGciOiJIUzI1NiIs..." }
```

- `Set-Cookie: refreshToken=abc123...; HttpOnly; Secure; SameSite=Strict`

**Error Response (401):** `{ "message": "Invalid credentials" }`

**Rate Limit (429):** `"Too many login attempts. Try again later."`

---

### 3я╕ПтГг GET `/api/v1/auth/me` тАФ ржирж┐ржЬрзЗрж░ рждржерзНржп

**Headers:**

```
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
```

**рж╕ржлрж▓ Response (200):**

```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "email": "reza@gmail.com",
  "role": "USER"
}
```

**Error Response (401):** `{ "message": "Unauthorized" }`

---

### 4я╕ПтГг POST `/api/v1/auth/refresh` тАФ Token Refresh

**Request:** ржХрзЛржирзЛ body рж▓рж╛ржЧрзЗ ржирж╛ тАФ cookie ржЖржкржирж╛ржЖржкржирж┐ ржкрж╛ржарж╛ржпрж╝

**рж╕ржлрж▓ Response (200):**

```json
{ "accessToken": "eyJhbGciOiJIUzI1NiIs..." }
```

- ржирждрзБржи `refreshToken` cookie рж╕рзЗржЯ рж╣ржпрж╝

**Error Response (401):** `{ "message": "Unauthorized" }`

---

### 5я╕ПтГг POST `/api/v1/auth/logout` тАФ рж▓ржЧржЖржЙржЯ

**Request:** ржХрзЛржирзЛ body рж▓рж╛ржЧрзЗ ржирж╛

**рж╕ржлрж▓ Response (200):**

```json
{ "message": "Logged out successfully" }
```

- `refreshToken` cookie ржорзБржЫрзЗ ржпрж╛ржпрж╝

---

### 6я╕ПтГг GET `/health` тАФ Health Check

**рж╕ржлрж▓ Response (200):**

```json
{
  "status": "ok",
  "uptime": 12345.678
}
```

---

# ржЕржзрзНржпрж╛ржпрж╝ рззрзл: ЁЯР│ Docker тАФ Scratch ржерзЗржХрзЗ Pro

## ржзрж╛ржк рзз: Docker ржХрзА?

Docker рж╣рж▓рзЛ **ржХржирзНржЯрзЗржЗржирж╛рж░рж╛ржЗржЬрзЗрж╢ржи** ржкрзНрж▓рзНржпрж╛ржЯржлрж░рзНржоред рждрзЛржорж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи + рждрж╛рж░ рж╕ржм dependencies ржПржХржЯрж╛ ржмрж╛ржХрзНрж╕рзЗ (container) ржнрж░рзЗ ржпрзЗржХрзЛржирзЛ ржХржорзНржкрж┐ржЙржЯрж╛рж░рзЗ ржЪрж╛рж▓рж╛рждрзЗ ржкрж╛рж░рзЛред

### ЁЯПа ржмрж╛рж╕рзНрждржм ржЙржжрж╛рж╣рж░ржг

**рж╕ржорж╕рзНржпрж╛ (Docker ржЫрж╛ржбрж╝рж╛)**:

```
рждрзБржорж┐: "ржЖржорж╛рж░ ржХржорзНржкрж┐ржЙржЯрж╛рж░рзЗ ржХрж╛ржЬ ржХрж░рзЗ!"
рж╕рж╣ржХрж░рзНржорзА: "ржЖржорж╛рж░ ржХржорзНржкрж┐ржЙржЯрж╛рж░рзЗ ржХрж╛ржЬ ржХрж░рзЗ ржирж╛!"
ржХрж╛рж░ржг: ржЖрж▓рж╛ржжрж╛ Node version, ржЖрж▓рж╛ржжрж╛ OS, ржЖрж▓рж╛ржжрж╛ config...
```

**рж╕ржорж╛ржзрж╛ржи (Docker ржжрж┐ржпрж╝рзЗ)**:

```
рждрзБржорж┐: "ржПржЗ Docker container ржирж╛ржУ, ржпрзЗржХрзЛржирзЛ ржХржорзНржкрж┐ржЙржЯрж╛рж░рзЗ ржЪрж▓ржмрзЗ!"
рж╕рж╣ржХрж░рзНржорзА: "ржХрж╛ржЬ ржХрж░ржЫрзЗ!" тЬЕ
```

ЁЯПа **ржЖрж░рзЛ рж╕рж╣ржЬ ржЙржжрж╛рж╣рж░ржг**: ржЯрж┐ржлрж┐ржи ржХрзНржпрж╛рж░рж┐ржпрж╝рж╛рж░рзЗ ржЦрж╛ржмрж╛рж░ ржнрж░рзЗ ржирзЗржУржпрж╝рж╛рж░ ржорждрзЛред ржЦрж╛ржмрж╛рж░ + ржерж╛рж▓рж╛ + ржЪрж╛ржоржЪ рж╕ржм ржПржХрж╕рж╛ржерзЗред ржпрзЗржЦрж╛ржирзЗржЗ ржирж┐ржпрж╝рзЗ ржпрж╛ржУ, ржЦрзЗрждрзЗ ржкрж╛рж░ржмрзЗ!

## ржзрж╛ржк рзи: ржорзВрж▓ ржзрж╛рж░ржгрж╛рж╕ржорзВрж╣

### Image (ржЗржорзЗржЬ) ржХрзА?

- ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ **ржмрзНрж▓рзБржкрзНрж░рж┐ржирзНржЯ/рж░рзЗрж╕рж┐ржкрж┐**
- Read-only тАФ ржкрж░рж┐ржмрж░рзНрждржи рж╣ржпрж╝ ржирж╛
- `Dockerfile` ржерзЗржХрзЗ рждрзИрж░рж┐ рж╣ржпрж╝
- ЁЯПа **ржЙржжрж╛рж╣рж░ржг**: ржкрж┐рзОржЬрж╛рж░ рж░рзЗрж╕рж┐ржкрж┐ ржмржЗ

### Container (ржХржирзНржЯрзЗржЗржирж╛рж░) ржХрзА?

- Image ржерзЗржХрзЗ рждрзИрж░рж┐ **ржЪрж▓ржорж╛ржи instance**
- ржПржХржЯрж╛ Image ржерзЗржХрзЗ ржЕржирзЗржХ Container ржЪрж╛рж▓рж╛ржирзЛ ржпрж╛ржпрж╝
- ЁЯПа **ржЙржжрж╛рж╣рж░ржг**: рж░рзЗрж╕рж┐ржкрж┐ ржерзЗржХрзЗ рждрзИрж░рж┐ ржЖрж╕рж▓ ржкрж┐рзОржЬрж╛ (ржЕржирзЗржХржЧрзБрж▓рзЛ ржмрж╛ржирж╛ржирзЛ ржпрж╛ржпрж╝)

### Volume (ржнрж▓рж┐ржЙржо) ржХрзА?

- **Persistent data storage** тАФ container ржорзБржЫрж▓рзЗржУ data ржерж╛ржХрзЗ
- ЁЯПа **ржЙржжрж╛рж╣рж░ржг**: ржлрзНрж░рж┐ржЬрзЗ ржЦрж╛ржмрж╛рж░ рж░рж╛ржЦрж╛ тАФ ржЪрзБрж▓рж╛ ржмржирзНржз ржХрж░рж▓рзЗржУ ржЦрж╛ржмрж╛рж░ ржерж╛ржХрзЗ

### Network (ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ) ржХрзА?

- Container-ржжрзЗрж░ ржоржзрзНржпрзЗ **ржпрзЛржЧрж╛ржпрзЛржЧрзЗрж░ ржкрже**
- ЁЯПа **ржЙржжрж╛рж╣рж░ржг**: ржЕржлрж┐рж╕рзЗрж░ internal phone line

## ржзрж╛ржк рзй: Dockerfile ржмрзЛржЭрж╛

### рж╕ржм Dockerfile Instructions

| Instruction   | ржХрж╛ржЬ                         | ржЙржжрж╛рж╣рж░ржг                      |
| ------------- | --------------------------- | --------------------------- |
| `FROM`        | Base image ржирж┐рж░рзНржмрж╛ржЪржи         | `FROM node:20-alpine`       |
| `WORKDIR`     | Working directory рж╕рзЗржЯ       | `WORKDIR /app`              |
| `COPY`        | ржлрж╛ржЗрж▓ ржХржкрж┐ (host тЖТ image)     | `COPY package.json ./`      |
| `ADD`         | COPY-ржПрж░ ржорждрзЛ + URL/tar supp. | `ADD app.tar.gz /app`       |
| `RUN`         | Build-time-ржП command ржЪрж╛рж▓рж╛ржУ  | `RUN npm install`           |
| `CMD`         | Container ржЪрж╛рж▓рзБ рж╣рж▓рзЗ ржХрзА ржЪрж▓ржмрзЗ  | `CMD ["node", "server.js"]` |
| `ENTRYPOINT`  | CMD-ржПрж░ ржорждрзЛ, override ржХржарж┐ржи   | `ENTRYPOINT ["node"]`       |
| `ENV`         | Environment variable рж╕рзЗржЯ    | `ENV NODE_ENV=production`   |
| `ARG`         | Build-time variable         | `ARG VERSION=1.0`           |
| `EXPOSE`      | ржХрзЛржи port ржмрзНржпржмрж╣рж╛рж░ рж╣ржмрзЗ (doc)  | `EXPOSE 5100`               |
| `VOLUME`      | Data persist point          | `VOLUME /data`              |
| `HEALTHCHECK` | Container health check      | ржирж┐ржЪрзЗ ржжрзЗржЦрзЛ                   |
| `USER`        | ржХрзЛржи user-ржП ржЪрж▓ржмрзЗ             | `USER node`                 |
| `LABEL`       | Metadata ржпрзЛржЧ                | `LABEL version="1.0"`       |

### Multi-stage Build ржХрзА?

ржПржХржЯрж╛ Dockerfile-ржП **ржПржХрж╛ржзрж┐ржХ `FROM`** тАФ ржкрзНрж░ржержо stage-ржП build, ржжрзНржмрж┐рждрзАржпрж╝ stage-ржП рж╢рзБржзрзБ ржжрж░ржХрж╛рж░рж┐ ржлрж╛ржЗрж▓ ржХржкрж┐ред

```dockerfile
# Stage 1: Build (ржмржбрж╝ тАФ build tools рж╕рж╣)
FROM node:20 AS builder
RUN npm install
RUN npm run build

# Stage 2: Production (ржЫрзЛржЯ тАФ рж╢рзБржзрзБ ржЪрж╛рж▓рж╛ржирзЛрж░ ржЬржирзНржп ржжрж░ржХрж╛рж░рж┐ ржлрж╛ржЗрж▓)
FROM node:20-alpine
COPY --from=builder /app/dist ./dist
CMD ["node", "dist/server.js"]
```

**рж╕рзБржмрж┐ржзрж╛**: Image size рзлрзж-рзорзж% ржЫрзЛржЯ рж╣ржпрж╝!

ЁЯПа **ржЙржжрж╛рж╣рж░ржг**: ржЧрж╛ржбрж╝рж┐ ржлрзНржпрж╛ржХрзНржЯрж░рж┐ тАФ ржлрзНржпрж╛ржХрзНржЯрж░рж┐рждрзЗ рж╣рж╛ржЬрж╛рж░ржЯрж╛ ржпржирзНрждрзНрж░ ржЖржЫрзЗ, ржХрж┐ржирзНрждрзБ customer-ржХрзЗ рж╢рзБржзрзБ рждрзИрж░рж┐ ржЧрж╛ржбрж╝рж┐ржЯрж╛ ржжрзЗржУржпрж╝рж╛ рж╣ржпрж╝, ржлрзНржпрж╛ржХрзНржЯрж░рж┐рж░ ржпржирзНрждрзНрж░ржкрж╛рждрж┐ ржирж╛!

## ржзрж╛ржк рзк: Docker Compose ржмрзЛржЭрж╛

Docker Compose = **ржПржХрж╛ржзрж┐ржХ container ржПржХрж╕рж╛ржерзЗ manage** ржХрж░рж╛рж░ ржЯрзБрж▓ред

### docker-compose.yml-ржПрж░ ржорзВрж▓ ржЕржВрж╢:

```yaml
version: "3.8" # Compose file version

services: # рж╕ржм container-ржПрж░ рждрж╛рж▓рж┐ржХрж╛
  app: # Service 1
    build: . # Dockerfile ржерзЗржХрзЗ build
    ports: ["3000:3000"] # Port mapping
    volumes: [...] # Data persist
    environment: [...] # Env variables
    depends_on: [...] # ржХрзЛржи service-ржПрж░ ржЙржкрж░ ржирж┐рж░рзНржнрж░
    restart: always # Crash рж╣рж▓рзЗ ржЖржмрж╛рж░ ржЪрж╛рж▓рзБ

  db: # Service 2
    image: mysql:8 # Ready-made image
    volumes: [...]

volumes: # Named volumes
  db_data:

networks: # Custom networks
  backend:
```

## ржзрж╛ржк рзл: Docker Layer Caching

Docker **ржкрзНрж░рждрж┐ржЯрж╛ instruction-ржХрзЗ layer** рж╣рж┐рж╕рзЗржмрзЗ cache ржХрж░рзЗ:

```dockerfile
# тЭМ ржнрзБрж▓ (ржХрзЛржб ржкрж░рж┐ржмрж░рзНрждржирзЗ рж╕ржм ржЖржмрж╛рж░ install рж╣ржмрзЗ):
COPY . .
RUN npm install

# тЬЕ рж╕ржарж┐ржХ (package.json ржирж╛ ржмржжрж▓рж╛рж▓рзЗ install skip рж╣ржмрзЗ):
COPY package*.json ./     # Layer 1: package files
RUN npm install           # Layer 2: dependencies (cached!)
COPY . .                  # Layer 3: source code
```

ЁЯПа **ржЙржжрж╛рж╣рж░ржг**: ржмрж╛ржерж░рзБржорзЗ ржЯрж╛ржЗрж▓рж╕ рж▓рж╛ржЧрж╛ржирзЛ тАФ ржирж┐ржЪрзЗрж░ ржЯрж╛ржЗрж▓рж╕ ржарж┐ржХ ржерж╛ржХрж▓рзЗ ржЙржкрж░рзЗрж░ржЯрж╛ржЗ рж╢рзБржзрзБ ржмржжрж▓рж╛ржУ

## ржзрж╛ржк рзм: Best Practices

1. **`.dockerignore` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ** тАФ ржЕржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржлрж╛ржЗрж▓ image-ржП ржпрж╛ржмрзЗ ржирж╛
2. **Multi-stage build** тАФ image size ржЫрзЛржЯ рж░рж╛ржЦрзЛ
3. **Alpine image ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ** тАФ `node:20-alpine` (~50MB) vs `node:20` (~300MB)
4. **Root user-ржП ржЪрж╛рж▓рж╛ржмрзЗ ржирж╛** тАФ security risk
5. **HEALTHCHECK ржпрзЛржЧ ржХрж░рзЛ** тАФ container рж╕рзБрж╕рзНрже ржХрж┐ржирж╛ ржЬрж╛ржирждрзЗ
6. **Layer caching optimize** тАФ package.json ржЖржЧрзЗ copy ржХрж░рзЛ
7. **`.env` ржлрж╛ржЗрж▓ image-ржП рж░рж╛ржЦржмрзЗ ржирж╛** тАФ secrets expose рж╣ржмрзЗ

## ЁЯР│ Docker Command Cheat Sheet

### ЁЯУж Image Commands

```bash
# Image рждрзИрж░рж┐
docker build -t myapp:v1 .
# -t = tag (ржирж╛ржо ржжрзЗржУржпрж╝рж╛)
# . = ржмрж░рзНрждржорж╛ржи ржбрж┐рж░рзЗржХрзНржЯрж░рж┐рж░ Dockerfile ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ

# рж╕ржм image ржжрзЗржЦрзЛ
docker images
# ржмрж╛
docker image ls

# Image ржорзБржЫрзЛ
docker rmi myapp:v1

# Docker Hub ржерзЗржХрзЗ image ржбрж╛ржЙржирж▓рзЛржб
docker pull node:20-alpine

# Docker Hub-ржП image ржЖржкрж▓рзЛржб
docker push myuser/myapp:v1

# ржЕржмрзНржпржмрж╣рзГржд image ржорзБржЫрзЛ
docker image prune

# Image-ржПрж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд рждржерзНржп
docker inspect myapp:v1

# Image-ржПрж░ layer ржЗрждрж┐рж╣рж╛рж╕
docker history myapp:v1
```

### ЁЯЪА Container Commands

```bash
# Container ржЪрж╛рж▓рзБ ржХрж░рзЛ
docker run -d -p 5100:5100 --name auth_app myapp:v1
# -d = detached (background-ржП ржЪрж▓ржмрзЗ)
# -p = port mapping (host:container)
# --name = container-ржПрж░ ржирж╛ржо

# ржЪрж▓ржорж╛ржи container ржжрзЗржЦрзЛ
docker ps
# рж╕ржм container (ржмржирзНржзрж╕рж╣)
docker ps -a

# Container ржмржирзНржз ржХрж░рзЛ
docker stop auth_app

# Container ржЪрж╛рж▓рзБ ржХрж░рзЛ (ржЖржЧрзЗ ржмржирзНржз ржХрж░рж╛)
docker start auth_app

# Container restart
docker restart auth_app

# Container ржорзБржЫрзЛ
docker rm auth_app
# ржЪрж▓ржорж╛ржи container ржЬрзЛрж░ ржХрж░рзЗ ржорзБржЫрзЛ
docker rm -f auth_app

# Container-ржПрж░ log ржжрзЗржЦрзЛ
docker logs auth_app
# Live log (follow)
docker logs -f auth_app
# рж╢рзЗрж╖ рзлрзж рж▓рж╛ржЗржи
docker logs --tail 50 auth_app

# Container-ржПрж░ ржнрзЗрждрж░рзЗ ржврзЛржХрзЛ
docker exec -it auth_app sh
# -it = interactive terminal
# sh = shell ржЪрж╛рж▓рж╛ржУ

# Container-ржПрж░ ржнрзЗрждрж░рзЗ command ржЪрж╛рж▓рж╛ржУ
docker exec auth_app ls /app

# Container-ржПрж░ resource usage
docker stats

# Container-ржПрж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд рждржерзНржп
docker inspect auth_app
```

### ЁЯО╝ Docker Compose Commands

```bash
# рж╕ржм service ржЪрж╛рж▓рзБ ржХрж░рзЛ
docker compose up
# Background-ржП
docker compose up -d
# Build ржХрж░рзЗ ржЪрж╛рж▓рзБ
docker compose up --build -d

# рж╕ржм service ржмржирзНржз ржХрж░рзЛ
docker compose down
# Volume-рж╕рж╣ ржорзБржЫрзЛ (тЪая╕П data рж╣рж╛рж░рж╛ржмрзЗ!)
docker compose down -v

# ржЪрж▓ржорж╛ржи service ржжрзЗржЦрзЛ
docker compose ps

# ржирж┐рж░рзНржжрж┐рж╖рзНржЯ service-ржПрж░ log
docker compose logs app
# Live log
docker compose logs -f app

# ржирж┐рж░рзНржжрж┐рж╖рзНржЯ service restart
docker compose restart app

# ржирж┐рж░рзНржжрж┐рж╖рзНржЯ service-ржПрж░ ржнрзЗрждрж░рзЗ ржврзЛржХрзЛ
docker compose exec app sh

# ржирж┐рж░рзНржжрж┐рж╖рзНржЯ service ржЖржмрж╛рж░ build
docker compose build app
```

### ЁЯТ╛ Volume Commands

```bash
# рж╕ржм volume ржжрзЗржЦрзЛ
docker volume ls

# Volume рждрзИрж░рж┐
docker volume create my_data

# Volume ржорзБржЫрзЛ
docker volume rm my_data

# ржЕржмрзНржпржмрж╣рзГржд volume ржорзБржЫрзЛ
docker volume prune
```

### ЁЯМР Network Commands

```bash
# рж╕ржм network ржжрзЗржЦрзЛ
docker network ls

# Network рждрзИрж░рж┐
docker network create my_network

# Network-ржПрж░ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд
docker network inspect my_network

# Container-ржХрзЗ network-ржП ржпрзБржХрзНржд
docker network connect my_network auth_app
```

### ЁЯз╣ Cleanup Commands

```bash
# рж╕ржм ржЕржмрзНржпржмрж╣рзГржд resource ржорзБржЫрзЛ (тЪая╕П рж╕рж╛ржмржзрж╛ржи!)
docker system prune

# Image, container, volume, network тАФ рж╕ржм ржорзБржЫрзЛ
docker system prune -a --volumes

# ржХрждржЯрзБржХрзБ disk ржмрзНржпржмрж╣рж╛рж░ рж╣ржЪрзНржЫрзЗ
docker system df
```

### ЁЯФН Debug Commands

```bash
# Container-ржПрж░ process ржжрзЗржЦрзЛ
docker top auth_app

# Container-ржПрж░ port mapping
docker port auth_app

# Container-ржПрж░ IP address
docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' auth_app

# Image-ржПрж░ size
docker images --format "{{.Repository}}:{{.Tag}} {{.Size}}"
```

---

# ржЕржзрзНржпрж╛ржпрж╝ рззрзм: ЁЯЪА CI/CD Pipeline тАФ Scratch ржерзЗржХрзЗ Pro

## ржзрж╛ржк рзз: CI/CD ржХрзА?

### CI тАФ Continuous Integration (ржХрзНрж░ржорж╛ржЧржд рж╕ржВржпрзЛржЬржи)

ржХрзЛржб push ржХрж░рж▓рзЗржЗ **ржЖржкржирж╛ржЖржкржирж┐ ржкрж░рзАржХрзНрж╖рж╛** рж╣ржпрж╝: lint, test, security scanред ржХрзЛржирзЛ рж╕ржорж╕рзНржпрж╛ ржерж╛ржХрж▓рзЗ рж╕рж╛ржерзЗ рж╕рж╛ржерзЗ ржЬрж╛ржирж╛ ржпрж╛ржпрж╝ред

ЁЯПа **ржЙржжрж╛рж╣рж░ржг**: ржлрзНржпрж╛ржХрзНржЯрж░рж┐рж░ ржХрзЛржпрж╝рж╛рж▓рж┐ржЯрж┐ ржЪрзЗржХ рж▓рж╛ржЗржи тАФ ржкрзНрж░рждрж┐ржЯрж╛ ржкржгрзНржп рждрзИрж░рж┐рж░ ржкрж░рзЗ ржЪрзЗржХ рж╣ржпрж╝, рж╢рзЗрж╖рзЗ ржиржпрж╝!

### CD тАФ Continuous Deployment/Delivery (ржХрзНрж░ржорж╛ржЧржд ржмрж┐рждрж░ржг)

CI ржкрж╛рж╕ рж╣рж▓рзЗ **ржЖржкржирж╛ржЖржкржирж┐ deploy** рж╣ржпрж╝ staging ржмрж╛ production рж╕рж╛рж░рзНржнрж╛рж░рзЗред

ЁЯПа **ржЙржжрж╛рж╣рж░ржг**: ржХрзЛржпрж╝рж╛рж▓рж┐ржЯрж┐ ржкрж╛рж╕ ржХрж░рж╛ ржкржгрзНржп ржЖржкржирж╛ржЖржкржирж┐ ржжрзЛржХрж╛ржирзЗ ржЪрж▓рзЗ ржпрж╛ржпрж╝

### ржХрзЗржи ржжрж░ржХрж╛рж░?

```
тЭМ CI/CD ржЫрж╛ржбрж╝рж╛:
  ржХрзЛржб рж▓рзЗржЦрзЛ тЖТ manually test ржХрж░рзЛ тЖТ manually deploy ржХрж░рзЛ тЖТ ржнрзБрж▓ рж╣рж▓рзЗ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ ржжрзЗржЦрзЗ!

тЬЕ CI/CD ржжрж┐ржпрж╝рзЗ:
  ржХрзЛржб push тЖТ auto test тЖТ auto deploy тЖТ ржнрзБрж▓ рж╣рж▓рзЗ ржЖржЧрзЗржЗ ржзрж░рж╛ ржкржбрж╝рзЗ!
```

## ржзрж╛ржк рзи: GitHub Actions ржмрзЛржЭрж╛

GitHub Actions рж╣рж▓рзЛ GitHub-ржПрж░ **built-in CI/CD** рж╕рж╛рж░рзНржнрж┐рж╕ред `.github/workflows/` ржлрзЛрж▓рзНржбрж╛рж░рзЗ YAML ржлрж╛ржЗрж▓рзЗ pipeline рж▓рзЗржЦрж╛ рж╣ржпрж╝ред

### ржорзВрж▓ ржзрж╛рж░ржгрж╛рж╕ржорзВрж╣

| ржзрж╛рж░ржгрж╛             | ржХрзА                       | ржЙржжрж╛рж╣рж░ржг                             |
| ----------------- | ------------------------ | ---------------------------------- |
| **Workflow**      | ржкрзБрж░рзЛ pipeline            | `.github/workflows/ci.yml`         |
| **Event/Trigger** | ржХржЦржи ржЪрж▓ржмрзЗ                 | `push`, `pull_request`, `schedule` |
| **Job**           | ржПржХржЯрж╛ ржХрж╛ржЬрзЗрж░ ржЧрзНрж░рзБржк         | `lint`, `test`, `build`            |
| **Step**          | Job-ржПрж░ ржнрзЗрждрж░рзЗ ржПржХржЯрж╛ ржзрж╛ржк    | `npm install`, `npm test`          |
| **Runner**        | ржпрзЗ ржХржорзНржкрж┐ржЙржЯрж╛рж░рзЗ ржЪрж▓рзЗ        | `ubuntu-latest`, `windows-latest`  |
| **Action**        | Ready-made reusable step | `actions/checkout@v4`              |
| **Secret**        | ржЧрзЛржкржи рждржерзНржп                | `${{ secrets.MY_TOKEN }}`          |
| **Artifact**      | Build output ржлрж╛ржЗрж▓        | test reports, build files          |

### YAML Syntax ржмрзЛржЭрзЛ

```yaml
name: My Pipeline # Pipeline-ржПрж░ ржирж╛ржо

# ржХржЦржи ржЪрж▓ржмрзЗ?
on:
  push: # ржХрзЛржб push ржХрж░рж▓рзЗ
    branches: [main] # рж╢рзБржзрзБ main branch-ржП
  pull_request: # PR рждрзИрж░рж┐/ржЖржкржбрзЗржЯ рж╣рж▓рзЗ
  schedule: # ржирж┐рж░рзНржжрж┐рж╖рзНржЯ рж╕ржоржпрж╝рзЗ (cron)
    - cron: "0 0 * * *" # ржкрзНрж░рждрж┐ржжрж┐ржи рж░рж╛ржд рззрзиржЯрж╛ржпрж╝
  workflow_dispatch: # рж╣рж╛рждрзЗ ржЪрж╛рж▓рж╛ржирзЛ ржпрж╛ржмрзЗ (manual trigger)

# ржХрзА ржХрзА ржХрж╛ржЬ рж╣ржмрзЗ?
jobs:
  job-name: # Job-ржПрж░ ржирж╛ржо (unique)
    runs-on: ubuntu-latest # ржХрзЛржи OS-ржП ржЪрж▓ржмрзЗ
    needs: [other-job] # ржХрзЛржи job ржЖржЧрзЗ рж╢рзЗрж╖ рж╣рждрзЗ рж╣ржмрзЗ (optional)

    steps: # ржзрж╛ржкржЧрзБрж▓рзЛ
      - name: Step 1 # ржзрж╛ржкрзЗрж░ ржирж╛ржо
        uses: action@version # Pre-built action ржмрзНржпржмрж╣рж╛рж░
        with: # Action-ржПрж░ settings
          key: value

      - name: Step 2
        run: echo "Hello" # Shell command ржЪрж╛рж▓рж╛ржУ

      - name: Step 3
        run: | # Multiline command
          npm install
          npm test
        env: # Environment variables
          NODE_ENV: test
```

## ржзрж╛ржк рзй: Trigger/Events (ржХржЦржи ржЪрж▓ржмрзЗ?)

```yaml
# рзз. Push event тАФ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ branch-ржП push рж╣рж▓рзЗ
on:
  push:
    branches: [main, develop]
    paths:                # ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржлрж╛ржЗрж▓ ржкрж░рж┐ржмрж░рзНрждржи рж╣рж▓рзЗ
      - 'src/**'
      - 'package.json'
    paths-ignore:         # ржПржЧрзБрж▓рзЛ ржкрж░рж┐ржмрж░рзНрждржи рж╣рж▓рзЗ ржЪрж▓ржмрзЗ ржирж╛
      - '**.md'
      - 'docs/**'

# рзи. Pull Request event
on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches: [main]

# рзй. Schedule (cron job)
on:
  schedule:
    - cron: '0 2 * * 1'  # ржкрзНрж░рждрж┐ рж╕рзЛржоржмрж╛рж░ рж░рж╛ржд рзиржЯрж╛ржпрж╝

# рзк. Manual trigger
on:
  workflow_dispatch:
    inputs:               # рж╣рж╛рждрзЗ input ржжрзЗржУржпрж╝рж╛ ржпрж╛ржмрзЗ
      environment:
        type: choice
        options: [staging, production]

# рзл. ржЕржирзНржп workflow рж╢рзЗрж╖ рж╣рж▓рзЗ
on:
  workflow_run:
    workflows: ["CI Pipeline"]
    types: [completed]
```

## ржзрж╛ржк рзк: Jobs ржУ Steps ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд

### Job Dependencies (needs)

```yaml
jobs:
  lint:
    runs-on: ubuntu-latest
    steps: [...]

  test:
    needs: lint # lint рж╢рзЗрж╖ ржирж╛ рж╣рж▓рзЗ test рж╢рзБрж░рзБ рж╣ржмрзЗ ржирж╛
    steps: [...]

  build:
    needs: [lint, test] # ржжрзБржЯрзЛржЗ рж╢рзЗрж╖ рж╣рждрзЗ рж╣ржмрзЗ
    steps: [...]
```

```
lint тФАтФАтЖТ test тФАтФАтЖТ build    (ржХрзНрж░ржорж╛ржирзБрж╕рж╛рж░рзЗ)
lint тФАтФР
      тФЬтФАтФАтЖТ build           (ржЕржержмрж╛ parallel-ржП)
test тФАтФШ
```

### Conditional Execution (if)

```yaml
jobs:
  deploy:
    if: github.ref == 'refs/heads/main'
    # рж╢рзБржзрзБ main branch-ржП deploy рж╣ржмрзЗ

  notify:
    if: failure()
    # ржЖржЧрзЗрж░ job fail рж╣рж▓рзЗ ржЪрж▓ржмрзЗ (notification ржкрж╛ржарж╛рждрзЗ)

  skip-ci:
    if: "!contains(github.event.head_commit.message, '[skip ci]')"
    # Commit message-ржП [skip ci] ржерж╛ржХрж▓рзЗ skip рж╣ржмрзЗ
```

### ржЬржиржкрзНрж░рж┐ржпрж╝ Actions

| Action                        | ржХрж╛ржЬ                   | ржмрзНржпржмрж╣рж╛рж░              |
| ----------------------------- | --------------------- | -------------------- |
| `actions/checkout@v4`         | ржХрзЛржб ржбрж╛ржЙржирж▓рзЛржб           | ржкрзНрж░рж╛ржпрж╝ рж╕ржм workflow-ржП |
| `actions/setup-node@v4`       | Node.js install       | Node.js ржкрзНрж░ржЬрзЗржХрзНржЯрзЗ    |
| `actions/cache@v3`            | Dependencies cache    | Build ржжрзНрж░рзБржд ржХрж░рждрзЗ     |
| `docker/build-push-action@v5` | Docker build + push   | Container deploy     |
| `docker/login-action@v3`      | Docker registry login | GHCR, Docker Hub     |
| `aquasecurity/trivy-action`   | Security scanning     | Vulnerability check  |

## ржзрж╛ржк рзл: Secrets ржУ Environment Variables

### Secrets (ржЧрзЛржкржи рждржерзНржп)

```
GitHub Repo тЖТ Settings тЖТ Secrets and variables тЖТ Actions тЖТ New repository secret
```

```yaml
steps:
  - name: Use secret
    env:
      MY_SECRET: ${{ secrets.MY_SECRET }}
    run: echo "Secret is set"
    # тЪая╕П echo $MY_SECRET ржХрж░рж▓рзЗржУ GitHub mask ржХрж░рзЗ ржжрзЗржмрзЗ тАФ ржХрзЗржЙ ржжрзЗржЦрждрзЗ ржкрж╛ржмрзЗ ржирж╛
```

### Built-in Variables

```yaml
${{ github.actor }}          # ржХрзЗ push ржХрж░рзЗржЫрзЗ
${{ github.repository }}     # repo-ржПрж░ ржирж╛ржо (user/repo)
${{ github.ref }}            # branch/tag reference
${{ github.sha }}            # commit hash
${{ github.event_name }}     # event type (push, PR, etc.)
${{ secrets.GITHUB_TOKEN }}  # GitHub auto-generated token
```

## ржзрж╛ржк рзм: Environments (Staging ржУ Production)

```
GitHub Repo тЖТ Settings тЖТ Environments тЖТ New environment
```

### Environment Features:

- **Protection rules**: Manual approval рж▓рж╛ржЧржмрзЗ deploy-ржПрж░ ржЖржЧрзЗ
- **Wait timer**: Deploy-ржПрж░ ржЖржЧрзЗ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ рж╕ржоржпрж╝ ржЕржкрзЗржХрзНрж╖рж╛
- **Branch policies**: рж╢рзБржзрзБ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ branch ржерзЗржХрзЗ deploy
- **Environment secrets**: ржЖрж▓рж╛ржжрж╛ secrets (production тЙа staging)

```yaml
jobs:
  deploy:
    environment: production # тЖР ржПржЗ environment-ржПрж░ rules apply рж╣ржмрзЗ
    steps: [...]
```

## ржзрж╛ржк рзн: Branching Strategy

### Git Flow (ржПржЗ ржкрзНрж░ржЬрзЗржХрзНржЯрзЗ ржмрзНржпржмрж╣рзГржд)

```
main (production)
  тЖС
develop (staging)
  тЖС
feature/xyz (new feature)
```

```
рзз. feature branch рждрзИрж░рж┐: git checkout -b feature/login
рзи. ржХрзЛржб рж▓рзЗржЦрзЛ тЖТ commit тЖТ push
рзй. PR рждрзИрж░рж┐ ржХрж░рзЛ: feature тЖТ develop
   тЖТ CI ржЪрж▓ржмрзЗ (lint, test, security)
   тЖТ Code review рж╣ржмрзЗ
   тЖТ Merge рж╣рж▓рзЗ тЖТ develop-ржП CI тЖТ Staging deploy
рзк. Staging-ржП test ржХрж░рзЛ
рзл. develop тЖТ main PR рждрзИрж░рж┐ ржХрж░рзЛ
   тЖТ CI ржЪрж▓ржмрзЗ ржЖржмрж╛рж░
   тЖТ Manual approval тЖТ Production deploy
```

## ржзрж╛ржк рзо: рж╕ржорзНржкрзВрж░рзНржг CI/CD Pipeline ржЙржжрж╛рж╣рж░ржг

ржПржЗ ржкрзНрж░ржЬрзЗржХрзНржЯрзЗрж░ ржкрзБрж░рзЛ flow:

```
Developer тЖТ git push (develop)
    тФВ
    тЦ╝
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА CI Pipeline тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ                                     тФВ
тФВ  тСа Lint (ESLint)                    тФВ
тФВ     тФФтФА ржХрзЛржб рж╕рзНржЯрж╛ржЗрж▓ ржарж┐ржХ ржЖржЫрзЗ? тЬЕ          тФВ
тФВ         тФВ                           тФВ
тФВ  тСб Test (Jest)                     тФВ
тФВ     тФФтФА рж╕ржм test ржкрж╛рж╕? тЬЕ               тФВ
тФВ         тФВ                           тФВ
тФВ  тСв Security                        тФВ
тФВ     тФЬтФА npm audit (package vulns)    тФВ
тФВ     тФФтФА Trivy scan (code vulns) тЬЕ   тФВ
тФВ         тФВ                           тФВ
тФВ  тСг Docker Build                    тФВ
тФВ     тФЬтФА Image рждрзИрж░рж┐ тЬЕ                 тФВ
тФВ     тФФтФА Trivy image scan тЬЕ          тФВ
тФВ                                     тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
    тФВ
    тЦ╝
тФМтФАтФАтФАтФАтФАтФАтФА Deploy Pipeline тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ                                      тФВ
тФВ  develop branch тЖТ Staging Deploy     тФВ
тФВ  main branch тЖТ Production Deploy     тФВ
тФВ                  (Manual Approval)   тФВ
тФВ                                      тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

## ржзрж╛ржк рзп: Best Practices

1. **рж╕ржмрж╕ржоржпрж╝ `needs` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ** тАФ job order ржарж┐ржХ рж░рж╛ржЦрзЛ
2. **Secrets ржХржЦржирзЛ hardcode ржХрж░ржмрзЗ ржирж╛** тАФ GitHub Secrets ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ
3. **Cache ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ** тАФ `actions/cache` ржжрж┐ржпрж╝рзЗ npm install ржжрзНрж░рзБржд ржХрж░рзЛ
4. **Branch protection ржпрзЛржЧ ржХрж░рзЛ** тАФ main-ржП direct push ржмржирзНржз
5. **Security scan ржЕржмрж╢рзНржпржЗ ржХрж░рзЛ** тАФ Trivy, npm audit
6. **Environment ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ** тАФ staging ржУ production ржЖрж▓рж╛ржжрж╛
7. **Manual approval production-ржП** тАФ ржнрзБрж▓ deploy рж░рзЛржз
8. **Commit SHA tag** тАФ rollback рж╕рж╣ржЬ ржХрж░рждрзЗ
9. **`paths` filter ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ** тАФ ржЕржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ CI run рж░рзЛржз
10. **Notification ржпрзЛржЧ ржХрж░рзЛ** тАФ fail рж╣рж▓рзЗ Slack/Email-ржП ржЬрж╛ржирж╛ржУ

## ржзрж╛ржк рззрзж: рж╕рж╛ржзрж╛рж░ржг рж╕ржорж╕рзНржпрж╛ ржУ рж╕ржорж╛ржзрж╛ржи

| рж╕ржорж╕рзНржпрж╛                                   | рж╕ржорж╛ржзрж╛ржи                                          |
| ---------------------------------------- | ----------------------------------------------- |
| "Permission denied"                      | `permissions` block ржпрзЛржЧ ржХрж░рзЛ                     |
| "Secret not available in PR"             | Fork-ржПрж░ PR-рждрзЗ secrets ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ ржирж╛ (security) |
| CI ржЕржирзЗржХ ржзрзАрж░рзЗ ржЪрж▓ржЫрзЗ                        | Cache ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ, parallel jobs ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЛ    |
| Docker build fail                        | `docker build` locally ржЪрж╛рж▓рж┐ржпрж╝рзЗ debug ржХрж░рзЛ        |
| "Resource not accessible by integration" | `GITHUB_TOKEN` permissions ржЪрзЗржХ ржХрж░рзЛ              |

---

# ЁЯОЙ рж╢рзЗрж╖ ржХржерж╛

ржЕржнрж┐ржиржирзНржжржи! рждрзБржорж┐ ржкрзБрж░рзЛ `auth-service` ржкрзНрж░ржЬрзЗржХрзНржЯржЯрж┐ рж╕ржорзНржкрзВрж░рзНржгржнрж╛ржмрзЗ ржмрзБржЭрзЗржЫрзЛред рждрзБржорж┐ ржПржЦржи ржЬрж╛ржирзЛ:

тЬЕ Express.js ржжрж┐ржпрж╝рзЗ REST API ржмрж╛ржирж╛ржирзЛ
тЬЕ JWT + Refresh Token ржжрж┐ржпрж╝рзЗ Authentication
тЬЕ Prisma ORM ржжрж┐ржпрж╝рзЗ Database management
тЬЕ Docker ржжрж┐ржпрж╝рзЗ Containerization
тЬЕ GitHub Actions ржжрж┐ржпрж╝рзЗ CI/CD
тЬЕ Security best practices

**ржкрж░ржмрж░рзНрждрзА ржкржжржХрзНрж╖рзЗржк**: ржПржЗ ржкрзНрж░ржЬрзЗржХрзНржЯржЯрж┐ ржирж┐ржЬрзЗ рж╣рж╛рждрзЗ ржЖржмрж╛рж░ рждрзИрж░рж┐ ржХрж░рзЛ, ржкрзНрж░рждрж┐ржЯрж╛ ржлрж╛ржЗрж▓ ржирж┐ржЬрзЗ рж▓рзЗржЦрзЛред рж╢рзБржзрзБ ржкржбрж╝рзЗ рж╢рзЗржЦрж╛ ржпрж╛ржпрж╝ ржирж╛ тАФ **ржХрж░рзЗ рж╢рж┐ржЦрждрзЗ рж╣ржпрж╝!** ЁЯТк
